<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ëƒ¥10</title>
<meta name="theme-color" content="#ff6eb4">
<link rel="manifest" href="manifest.json">
<script>
// Canvas roundRect í´ë¦¬í•„
if(!CanvasRenderingContext2D.prototype.roundRect){
  CanvasRenderingContext2D.prototype.roundRect=function(x,y,w,h,r){
    this.beginPath();this.moveTo(x+r,y);this.lineTo(x+w-r,y);
    this.quadraticCurveTo(x+w,y,x+w,y+r);this.lineTo(x+w,y+h-r);
    this.quadraticCurveTo(x+w,y+h,x+w-r,y+h);this.lineTo(x+r,y+h);
    this.quadraticCurveTo(x,y+h,x,y+h-r);this.lineTo(x,y+r);
    this.quadraticCurveTo(x,y,x+r,y);this.closePath();
  };
}
</script>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800;900&display=swap" rel="stylesheet">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script>
<style>
:root{--bg:#fef6ff;--surface:#fff;--pink:#ff6eb4;--pink-dark:#d94d96;--mint:#4ecdc4;--red:#ff4f4f;--yellow:#ffcc00;--border:#f0d4f0;--shadow:rgba(200,100,200,0.12);--text:#3d2645;--dim:#b89db8;--c1:#ffadad;--c2:#ffcb8a;--c3:#fdffb6;--c4:#b5ead7;--c5:#a8e6f0;--c6:#a0c4ff;--c7:#c5b8ff;--c8:#ffb3de;--c9:#ff9090;--d1:#e05080;--d2:#d07020;--d3:#a89000;--d4:#30a870;--d5:#1890b0;--d6:#3060c0;--d7:#6040c0;--d8:#c040a0;--d9:#c02020;}
body.night{--bg:#1a1025;--surface:#2a1f35;--border:#3d2d50;--shadow:rgba(0,0,0,0.4);--text:#f0e0ff;--dim:#8a6a9a;--c1:#c45050;--c2:#b07030;--c3:#909060;--c4:#3a7a5a;--c5:#2a6a80;--c6:#2a50a0;--c7:#5a3a9a;--c8:#a03070;--c9:#b03030;}
body.night .live-bar,body.night .rule-card,body.night .sum-bar,body.night .pvp-bar,body.night .lb-card,body.night .settings-sheet,body.night .tut-box{background:#2a1f35;}
body.night .mute-btn,body.night .settings-btn{background:#2a1f35;}
body.night .settings-close{background:#3d2d50;color:#f0e0ff;}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{background:var(--bg);font-family:'Nunito',sans-serif;min-height:100dvh;display:flex;flex-direction:column;align-items:center;overflow:hidden;user-select:none;}
.screen{width:100%;max-width:420px;min-height:100dvh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:16px 14px;position:absolute;top:0;left:50%;transform:translateX(-50%);transition:opacity .2s,transform .2s;z-index:1;pointer-events:auto;}
.screen.hidden{opacity:0;pointer-events:none;transform:translateX(-50%) scale(.97);z-index:0;}
.logo-emoji{font-size:68px;display:block;text-align:center;animation:boing 2s ease-in-out infinite;}
@keyframes boing{0%,100%{transform:translateY(0) rotate(-4deg)}50%{transform:translateY(-10px) rotate(4deg)}}
.logo-title{font-size:60px;font-weight:900;text-align:center;line-height:1;color:var(--pink);text-shadow:0 5px 0 var(--pink-dark);letter-spacing:-1px;margin-top:4px;}
.logo-sub{font-size:12px;color:var(--dim);letter-spacing:3px;text-align:center;margin-bottom:14px;}
.live-bar{width:100%;background:white;border-radius:14px;border:2px solid var(--border);padding:10px 16px;margin-bottom:12px;box-shadow:0 3px 12px var(--shadow);display:flex;align-items:center;justify-content:space-between;}
.live-dot{width:8px;height:8px;border-radius:50%;background:#ff4f4f;animation:blink 1s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}
.live-txt{font-size:13px;font-weight:800;color:var(--text);}
.live-cnt{font-size:14px;font-weight:900;color:var(--pink);}
.rule-card{background:white;border-radius:22px;padding:12px 18px;width:100%;margin-bottom:14px;box-shadow:0 4px 20px var(--shadow);border:2px solid var(--border);}
.rule-item{display:flex;align-items:center;gap:10px;font-size:14px;font-weight:800;color:var(--text);padding:5px 0;border-bottom:1px solid var(--border);}
.rule-item:last-child{border:none;}
.ri{font-size:20px;width:28px;text-align:center;}
.btn-play{width:100%;height:62px;border:none;border-radius:22px;background:linear-gradient(135deg,#ff6eb4,#ff9fd3);color:white;font-family:'Nunito',sans-serif;font-size:22px;font-weight:900;cursor:pointer;box-shadow:0 7px 0 var(--pink-dark);transition:transform .1s,box-shadow .1s;position:relative;overflow:hidden;}
.btn-play::after{content:'';position:absolute;top:0;left:-100%;width:55%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.25),transparent);transform:skewX(-15deg);animation:shine 2.2s infinite;}
@keyframes shine{to{left:200%;}}
.btn-play:active{transform:translateY(4px);box-shadow:0 3px 0 var(--pink-dark);}

/* mute / settings ë²„íŠ¼ â€” í•­ìƒ ìµœìƒë‹¨ fixed */
.mute-btn{position:fixed;top:12px;right:14px;z-index:9999;width:38px;height:38px;border-radius:50%;border:2px solid var(--border);background:white;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px var(--shadow);}
.settings-btn{position:fixed;top:12px;left:14px;z-index:9999;width:38px;height:38px;border-radius:50%;border:2px solid var(--border);background:white;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px var(--shadow);}
/* settings modal */
.settings-modal{position:fixed;inset:0;z-index:500;display:flex;align-items:flex-end;justify-content:center;background:rgba(61,38,69,.45);backdrop-filter:blur(4px);}
.settings-modal.hidden{display:none;}
.settings-sheet{width:100%;max-width:420px;background:white;border-radius:28px 28px 0 0;padding:20px 20px 36px;box-shadow:0 -8px 40px rgba(200,100,200,.2);animation:slideUp .3s cubic-bezier(.2,1.3,.5,1);position:relative;}
@keyframes slideUp{from{transform:translateY(100%);}to{transform:translateY(0);}}
.settings-title{font-size:20px;font-weight:900;color:var(--text);text-align:center;margin-bottom:18px;}
.settings-close{position:absolute;top:16px;right:18px;background:var(--border);border:none;border-radius:50%;width:32px;height:32px;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:900;}
.settings-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border);}
.settings-label{font-size:14px;font-weight:800;color:var(--text);display:flex;align-items:center;gap:8px;}
.toggle-btn{width:54px;height:28px;border-radius:14px;border:none;cursor:pointer;position:relative;transition:background .2s;background:#ddd;}
.toggle-btn.on{background:var(--pink);}
.toggle-btn::after{content:'';position:absolute;top:3px;left:3px;width:22px;height:22px;border-radius:50%;background:white;transition:transform .2s;box-shadow:0 2px 4px rgba(0,0,0,.15);}
.toggle-btn.on::after{transform:translateX(26px);}
.settings-section{font-size:11px;font-weight:800;letter-spacing:2px;color:var(--dim);text-transform:uppercase;margin:14px 0 8px;}
.skin-grid{display:flex;gap:8px;flex-wrap:wrap;}
.skin-opt{width:54px;height:54px;border-radius:14px;border:3px solid var(--border);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1px;cursor:pointer;transition:border-color .15s,transform .1s;}
.skin-opt.active{border-color:var(--pink);transform:scale(1.1);}
.skin-opt .s-emoji{font-size:16px;line-height:1;}
.skin-opt .s-num{font-size:20px;font-weight:900;color:white;text-shadow:0 1px 4px rgba(0,0,0,.2);line-height:1;}
.theme-grid{display:flex;gap:8px;flex-wrap:wrap;}
.theme-opt{width:46px;height:46px;border-radius:12px;border:3px solid var(--border);cursor:pointer;transition:border-color .15s,transform .1s;}
.theme-opt.active{border-color:var(--pink);transform:scale(1.1);}
.settings-save{width:100%;height:50px;border:none;border-radius:16px;background:linear-gradient(135deg,#ff6eb4,#ff9fd3);color:white;font-family:'Nunito',sans-serif;font-size:18px;font-weight:900;cursor:pointer;margin-top:18px;box-shadow:0 5px 0 var(--pink-dark);}
.settings-save:active{transform:translateY(3px);box-shadow:0 2px 0 var(--pink-dark);}

.restart-btn{width:38px;height:38px;border-radius:50%;border:2px solid var(--border);background:white;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px var(--shadow);}
.restart-btn:active{transform:scale(.9);}
body.night .restart-btn{background:#2a1f35;}
.restart-modal{position:fixed;inset:0;z-index:400;background:rgba(61,38,69,.7);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;}
.restart-modal.hidden{display:none;}
.restart-box{background:white;border-radius:24px;padding:24px 20px;width:80%;max-width:300px;display:flex;flex-direction:column;align-items:center;gap:10px;box-shadow:0 20px 60px rgba(200,100,200,.3);}
body.night .restart-box{background:#2a1f35;}

/* â”€â”€ ìƒë‹¨ HUD: íƒ€ì´ë¨¸ + ì ìˆ˜ë§Œ í¬ê²Œ â”€â”€ */
.top-hud{width:100%;display:flex;align-items:center;justify-content:space-between;padding:0 4px;margin-bottom:6px;}

/* íƒ€ì´ë¨¸ â€” í¬ê²Œ */
.timer-ring-wrap{position:relative;width:72px;height:72px;display:flex;align-items:center;justify-content:center;}
.timer-ring-wrap svg{position:absolute;top:0;left:0;transform:rotate(-90deg);}
.tr-bg{fill:none;stroke:var(--border);stroke-width:5;}
.tr-fg{fill:none;stroke:var(--pink);stroke-width:5;stroke-linecap:round;transition:stroke-dashoffset 1s linear,stroke .3s;}
.timer-n{font-size:28px;font-weight:900;color:var(--text);position:relative;z-index:1;}

/* ì ìˆ˜ â€” í¬ê²Œ */
.score-block{text-align:right;}
.score-lbl{font-size:9px;font-weight:800;letter-spacing:2px;color:var(--dim);text-transform:uppercase;}
.score-val{font-size:48px;font-weight:900;color:var(--pink);line-height:1;text-shadow:0 3px 0 var(--pink-dark);}
.score-val.pop{animation:pop .15s ease;}
@keyframes pop{0%,100%{transform:scale(1)}50%{transform:scale(1.2)}}

/* ì½¤ë³´ í•„ â€” ì‘ê²Œ, ì ìˆ˜ ì•„ë˜ */
.combo-pill{background:linear-gradient(135deg,#c5b8ff,#a0c4ff);border-radius:20px;padding:2px 10px;font-size:12px;font-weight:900;color:white;opacity:.2;transition:opacity .2s;display:inline-block;margin-top:2px;}
.combo-pill.on{opacity:1;animation:cPop .2s ease;}
@keyframes cPop{0%,100%{transform:scale(1)}50%{transform:scale(1.2)}}

/* PVP ë°” â€” ë” ìŠ¬ë¦¼í•˜ê²Œ */
.pvp-bar{width:100%;background:white;border-radius:10px;border:2px solid var(--border);padding:4px 10px;margin-bottom:4px;box-shadow:0 2px 8px var(--shadow);display:flex;align-items:center;gap:6px;}
.pvp-name{font-size:10px;font-weight:800;color:var(--dim);white-space:nowrap;}
.pvp-pts{font-size:10px;font-weight:900;color:var(--text);white-space:nowrap;}
.pvp-track{flex:1;height:5px;background:var(--border);border-radius:4px;overflow:hidden;position:relative;}
.pvp-me{height:100%;background:linear-gradient(90deg,var(--pink),#ff9fd3);border-radius:4px;transition:width .4s ease;width:0%;position:absolute;top:0;left:0;}
.pvp-opp{height:100%;background:linear-gradient(90deg,#a0c4ff,#c5b8ff);border-radius:4px;transition:width .4s ease;width:0%;position:absolute;top:0;left:0;}
.pvp-status{font-size:10px;font-weight:900;white-space:nowrap;}

/* í•©ê³„ ë°” */
.sum-bar{width:100%;height:38px;background:white;border-radius:12px;border:2px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 12px;margin-bottom:4px;box-shadow:0 2px 10px var(--shadow);transition:border-color .2s,background .2s;}
.sum-bar.exact{border-color:var(--mint);background:#f0fffd;}
.sum-bar.shake{animation:shake .3s ease;}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-8px)}75%{transform:translateX(8px)}}
.sum-bar.close-glow{border-color:var(--yellow);animation:closeGlow .5s ease-in-out infinite alternate;}
@keyframes closeGlow{from{box-shadow:0 0 0 0 rgba(255,200,0,.3);}to{box-shadow:0 0 12px 4px rgba(255,200,0,.5);}}
.sum-lbl{font-size:10px;font-weight:800;color:var(--dim);}
.sum-num{font-size:22px;font-weight:900;color:var(--text);}
.sum-num.exact{color:var(--mint);}
.sum-num.close{color:var(--yellow);}
.sum-tip{font-size:11px;font-weight:800;color:var(--dim);text-align:right;max-width:42%;}
.sum-tip.exact{color:var(--mint);}
.combo-burst{position:fixed;left:50%;top:40%;transform:translate(-50%,-50%);pointer-events:none;z-index:200;
  font-family:'Nunito',sans-serif;font-weight:900;text-align:center;
  animation:comboB .55s cubic-bezier(.2,1.3,.5,1) forwards;}
@keyframes comboB{
  0%  {opacity:0;transform:translate(-50%,-50%) scale(.3);}
  30% {opacity:1;transform:translate(-50%,-50%) scale(1.2);}
  60% {opacity:1;transform:translate(-50%,-50%) scale(1);}
  100%{opacity:0;transform:translate(-50%,-60%) scale(.8);}
}
.grid-wrap{width:100%;border-radius:14px;overflow:visible;background:white;border:2px solid var(--border);box-shadow:0 4px 20px var(--shadow);padding:5px;}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:5px;}
.grid-cell{aspect-ratio:1;position:relative;border-radius:10px;background:var(--bg);border:2px dashed var(--border);}
.tnum{font-size:clamp(15px,4.5vw,22px);font-weight:900;position:relative;z-index:1;text-shadow:0 2px 4px rgba(0,0,0,.12);line-height:1;}
.tile{position:absolute;inset:2px;border-radius:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .1s;will-change:transform;}
.tile:active{transform:scale(.88)!important;}
.tile.selected{transform:scale(1.06) translateY(-3px)!important;z-index:10;animation:tJump .28s ease;}
@keyframes tJump{0%{transform:scale(1) translateY(0)}40%{transform:scale(1.1) translateY(-6px)}100%{transform:scale(1.06) translateY(-3px)}}
.tile.selected .ti{box-shadow:0 0 0 2px white,0 0 0 4px var(--pink),0 8px 20px rgba(255,110,180,.5);}
.tile.fall{animation:fallIn .1s ease-out both;}
@keyframes fallIn{0%{transform:translateY(-40%) scale(.85);opacity:0;}100%{transform:translateY(0) scale(1);opacity:1;}}
.tile.press-in{animation:pressIn .12s ease both;}
@keyframes pressIn{0%{transform:translateY(-50%);opacity:0;}100%{transform:translateY(0);opacity:1;}}
.tile.drop-down{animation:dropD var(--dd,.25s) cubic-bezier(.15,1.3,.5,1) both;}
@keyframes dropD{0%{transform:translateY(0);}60%{transform:translateY(calc(var(--dist)*1.08));}100%{transform:translateY(var(--dist));}}
.tile.removing{animation:popOff .15s ease forwards!important;z-index:20;}
@keyframes popOff{0%{transform:scale(1.1);opacity:1;}100%{transform:scale(0) rotate(30deg);opacity:0;}}
.ti{width:100%;height:100%;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:1px;box-shadow:0 4px 0 rgba(0,0,0,.09);position:relative;overflow:hidden;transition:box-shadow .12s;}
.ti::after{content:'';position:absolute;top:-20%;left:-20%;width:45%;height:45%;background:rgba(255,255,255,.28);border-radius:50%;pointer-events:none;}
.t-emoji{font-size:clamp(13px,3.5vw,18px);line-height:1;pointer-events:none;position:relative;z-index:1;}
.tnum{font-size:clamp(24px,7vw,34px);font-weight:900;color:white;position:relative;z-index:1;text-shadow:0 2px 6px rgba(0,0,0,.22);line-height:1;}
.t1 .ti{background:var(--c1);}
.t2 .ti{background:var(--c2);}
.t3 .ti{background:var(--c3);}
.t4 .ti{background:var(--c4);}
.t5 .ti{background:var(--c5);}
.t6 .ti{background:var(--c6);}
.t7 .ti{background:var(--c7);}
.t8 .ti{background:var(--c8);}
.t9 .ti{background:var(--c9);}
/* combo5 flash */
.combo5-flash{position:fixed;inset:0;pointer-events:none;z-index:70;animation:c5flash .6s ease forwards;}
@keyframes c5flash{0%{opacity:0;}15%{opacity:1;filter:invert(.9) hue-rotate(90deg);}40%{filter:invert(.5) hue-rotate(0deg);}70%{opacity:.5;}100%{opacity:0;filter:invert(0);}}
.flash-ov{position:fixed;inset:0;pointer-events:none;z-index:60;opacity:0;}
.flash-ov.ok{animation:flashOK .5s ease;}
.flash-ov.ng{animation:flashNG .4s ease;}
@keyframes flashOK{0%{opacity:0;}15%{opacity:1;background:rgba(78,205,196,.45);}100%{opacity:0;}}
@keyframes flashNG{0%{opacity:0;}15%{opacity:1;background:rgba(255,60,60,.4);}100%{opacity:0;}}
body.shakebody{animation:bodyShake .45s ease;}
@keyframes bodyShake{0%,100%{transform:translateX(0)}15%{transform:translateX(-12px) rotate(-1deg)}30%{transform:translateX(12px) rotate(1deg)}45%{transform:translateX(-8px)}60%{transform:translateX(8px)}75%{transform:translateX(-4px)}90%{transform:translateX(4px)}}
.grid-wrap.success-zoom{animation:gridZoom .35s ease;}
@keyframes gridZoom{0%,100%{transform:scale(1)}40%{transform:scale(1.04)}70%{transform:scale(.98)}}
.combo-flash{position:fixed;inset:0;pointer-events:none;z-index:55;opacity:0;animation:comboFlash .5s ease forwards;}
@keyframes comboFlash{0%{opacity:0}20%{opacity:.7}100%{opacity:0}}
.panic-border{position:fixed;inset:0;pointer-events:none;z-index:50;}
.panic-border.on{animation:panicP .4s ease-in-out infinite alternate;}
@keyframes panicP{from{box-shadow:inset 0 0 0 4px rgba(255,60,60,.4),inset 0 0 30px rgba(255,60,60,.1);}to{box-shadow:inset 0 0 0 10px rgba(255,60,60,.9),inset 0 0 70px rgba(255,60,60,.4);}}
.fx{position:fixed;pointer-events:none;z-index:999;font-family:'Nunito',sans-serif;font-weight:900;transform:translateX(-50%);animation:fxUp 1s ease forwards;}
@keyframes fxUp{0%{opacity:1;transform:translateX(-50%) translateY(0) scale(1.2);}20%{opacity:1;transform:translateX(-50%) translateY(-10px) scale(1);}100%{opacity:0;transform:translateX(-50%) translateY(-80px) scale(.7);}}
.pt{position:fixed;pointer-events:none;z-index:998;border-radius:50%;animation:ptFly .7s ease forwards;}
@keyframes ptFly{0%{opacity:1;transform:translate(0,0) scale(1);}100%{opacity:0;transform:translate(var(--tx),var(--ty)) scale(0);}}
.milestone{position:fixed;top:20%;left:50%;transform:translateX(-50%);background:white;border-radius:30px;padding:12px 26px;border:3px solid var(--pink);font-size:20px;font-weight:900;color:var(--pink);box-shadow:0 10px 40px rgba(255,110,180,.4);z-index:200;white-space:nowrap;animation:msA 2s ease forwards;pointer-events:none;}
@keyframes msA{0%{opacity:0;transform:translateX(-50%) scale(.5);}15%{opacity:1;transform:translateX(-50%) scale(1.15);}50%{opacity:1;transform:translateX(-50%) scale(1);}100%{opacity:0;transform:translateX(-50%) translateY(-24px);}}
#resultScreen{gap:5px;justify-content:flex-start;padding-top:14px;padding-bottom:20px;overflow-y:auto;}
.res-emoji{font-size:52px;animation:boing 2s ease-in-out infinite;}
.res-top{font-size:11px;font-weight:800;letter-spacing:3px;color:var(--dim);text-transform:uppercase;}
.res-grade{font-size:17px;font-weight:900;padding:5px 18px;border-radius:30px;}
.res-score{font-size:clamp(60px,18vw,88px);font-weight:900;color:var(--pink);line-height:1;text-shadow:0 5px 0 var(--pink-dark);}
.res-sub{font-size:13px;font-weight:800;color:var(--dim);}
.res-sub b{color:var(--text);}
.res-rank{font-size:13px;font-weight:900;color:var(--mint);}
.res-best{font-size:12px;font-weight:800;color:var(--dim);}
.res-best b{color:var(--pink);}
.res-best-gap{font-size:13px;font-weight:900;color:var(--mint);text-align:center;min-height:18px;}
.lb-card{width:100%;background:white;border-radius:16px;border:2px solid var(--border);padding:10px 14px;box-shadow:0 3px 16px var(--shadow);}
.lb-title{font-size:11px;font-weight:800;letter-spacing:2px;color:var(--dim);text-transform:uppercase;margin-bottom:6px;}
.lb-row{display:flex;align-items:center;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--border);font-size:12px;font-weight:800;color:var(--text);}
.lb-row:last-child{border:none;}
.lb-row.me{color:var(--pink);}
.lb-rank{width:24px;}.lb-name{flex:1;}
.btn-retry{width:100%;height:54px;border:none;border-radius:18px;background:linear-gradient(135deg,#ff6eb4,#ff9fd3);color:white;font-family:'Nunito',sans-serif;font-size:20px;font-weight:900;cursor:pointer;box-shadow:0 6px 0 var(--pink-dark);transition:transform .1s,box-shadow .1s;position:relative;overflow:hidden;}
.btn-retry::after{content:'';position:absolute;top:0;left:-100%;width:55%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.25),transparent);transform:skewX(-15deg);animation:shine 1.5s infinite;}
.btn-retry:active{transform:translateY(4px);box-shadow:0 2px 0 var(--pink-dark);}
.retry-hint{font-size:10px;font-weight:800;color:var(--dim);letter-spacing:1px;text-align:center;}
.btn-share{width:100%;height:40px;border:2px solid var(--border);border-radius:12px;background:white;color:var(--dim);font-family:'Nunito',sans-serif;font-size:13px;font-weight:800;cursor:pointer;transition:border-color .2s,color .2s;}
.btn-share:hover{border-color:var(--pink);color:var(--pink);}
.share-section{width:100%;}
.share-label{font-size:11px;font-weight:800;letter-spacing:2px;color:var(--dim);text-align:center;margin-bottom:8px;text-transform:uppercase;}
.share-grid{display:flex;justify-content:center;gap:10px;margin-bottom:4px;}
.share-btn{width:52px;height:52px;border-radius:16px;border:none;font-size:22px;font-weight:900;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 0 rgba(0,0,0,.1);transition:transform .1s,box-shadow .1s;}
.share-btn:active{transform:translateY(3px);box-shadow:0 1px 0 rgba(0,0,0,.1);}
.share-x{background:#000;color:#fff;font-family:serif;}
.share-threads{background:linear-gradient(135deg,#000,#333);color:#fff;}
.share-kakao{background:#fee500;color:#3c1e1e;}
.share-link{background:linear-gradient(135deg,var(--mint),#7ee8e0);color:#fff;}
.share-native{background:linear-gradient(135deg,var(--pink),#ff9fd3);color:#fff;}
.share-labels-row{display:flex;justify-content:center;gap:10px;}
.share-labels-row span{width:52px;text-align:center;font-size:9px;font-weight:800;color:var(--dim);}
body.night .share-btn{box-shadow:0 4px 0 rgba(0,0,0,.3);}
body.night .share-link{background:linear-gradient(135deg,#2a8a84,#3aaa9a);}
.ad-slot{width:100%;height:48px;border:2px dashed var(--border);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;letter-spacing:2px;color:var(--dim);}
.cd-ov{position:fixed;inset:0;background:rgba(254,246,255,.93);display:flex;align-items:center;justify-content:center;flex-direction:column;gap:6px;z-index:100;}
.cd-ov.hidden{display:none;}
.cd-n{font-size:130px;font-weight:900;color:var(--pink);text-shadow:0 10px 0 var(--pink-dark);animation:cdPop .8s ease;}
@keyframes cdPop{0%{transform:scale(2);opacity:0;}30%{transform:scale(1);opacity:1;}80%{transform:scale(1);opacity:1;}100%{transform:scale(.7);opacity:0;}}
.cd-sub{font-size:14px;font-weight:800;color:var(--dim);}
.go-flash{position:fixed;inset:0;pointer-events:none;z-index:100;display:flex;align-items:center;justify-content:center;}
.go-flash.hidden{display:none;}
.go-txt{font-family:'Nunito',sans-serif;font-size:100px;font-weight:900;color:var(--pink);text-shadow:0 8px 0 var(--pink-dark);animation:goAnim .6s ease forwards;}
@keyframes goAnim{0%{transform:scale(2);opacity:0;}25%{transform:scale(1);opacity:1;}75%{transform:scale(1);opacity:1;}100%{transform:scale(.5);opacity:0;}}

/* ì¼ì¼ ì±Œë¦°ì§€ */
.daily-challenge{width:100%;background:linear-gradient(135deg,#fff8e1,#fff3cd);border:2px solid #ffcc00;border-radius:14px;padding:8px 14px;display:flex;align-items:center;gap:8px;margin-bottom:10px;box-shadow:0 2px 8px rgba(255,200,0,.15);}
body.night .daily-challenge{background:linear-gradient(135deg,#2a2010,#1e1a08);border-color:#aa8800;}
.dc-badge{font-size:10px;font-weight:900;color:#a07000;white-space:nowrap;}
.dc-text{flex:1;font-size:12px;font-weight:800;color:var(--text);}
.dc-status{font-size:18px;}
/* ìŠ¤í‚¨ ì ê¸ˆ */
.skin-opt.locked{opacity:.5;position:relative;}
.skin-opt.locked::after{content:'ğŸ”’';position:absolute;font-size:18px;top:50%;left:50%;transform:translate(-50%,-50%);}

/* ìµœê³ ì  ê²½ì‹  */
.best-burst{position:fixed;inset:0;z-index:300;display:flex;align-items:center;justify-content:center;pointer-events:none;}
.best-burst.hidden{display:none;}
.best-burst-inner{background:linear-gradient(135deg,#ffcc00,#ff9fd3);border-radius:30px;padding:18px 36px;font-family:'Nunito',sans-serif;font-size:28px;font-weight:900;color:white;text-shadow:0 3px 0 rgba(0,0,0,.15);box-shadow:0 10px 40px rgba(255,200,0,.5);animation:bestPop 2s ease forwards;}
@keyframes bestPop{0%{opacity:0;transform:scale(.3);}20%{opacity:1;transform:scale(1.15);}40%{transform:scale(1);}75%{opacity:1;}100%{opacity:0;transform:scale(.9) translateY(-20px);}}

/* íŠœí† ë¦¬ì–¼ */
.tut-ov{position:fixed;inset:0;z-index:400;background:rgba(61,38,69,.7);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;}
.tut-ov.hidden{display:none;}
.tut-box{background:white;border-radius:28px;padding:28px 24px;width:88%;max-width:360px;display:flex;flex-direction:column;align-items:center;gap:12px;box-shadow:0 20px 60px rgba(200,100,200,.3);}
.tut-emoji{font-size:52px;animation:boing 2s ease-in-out infinite;}
.tut-title{font-size:22px;font-weight:900;color:var(--text);}
.tut-step{width:100%;font-size:14px;font-weight:800;color:var(--text);background:var(--bg);border-radius:12px;padding:10px 14px;border:2px solid var(--border);}
.tut-btn{width:100%;height:52px;border:none;border-radius:18px;background:linear-gradient(135deg,#ff6eb4,#ff9fd3);color:white;font-family:'Nunito',sans-serif;font-size:20px;font-weight:900;cursor:pointer;box-shadow:0 6px 0 var(--pink-dark);margin-top:4px;}
.tut-btn:active{transform:translateY(3px);box-shadow:0 3px 0 var(--pink-dark);}
</style>
</head>
<body>
<div class="panic-border" id="panicBorder"></div>
<div class="flash-ov" id="flashOv"></div>
<button class="settings-btn" onclick="openSettings()" title="ì„¤ì •">âš™ï¸</button>
<button class="mute-btn" id="muteBtn" onclick="toggleMute()" title="ìŒì†Œê±°">ğŸ”Š</button>

<!-- SETTINGS MODAL -->
<div class="settings-modal hidden" id="settingsModal" onclick="closeSettingsBg(event)">
  <div class="settings-sheet">
    <div class="settings-title">âš™ï¸ ì„¤ì •</div>
    <button class="settings-close" onclick="closeSettings()">âœ•</button>

    <div class="settings-row" style="flex-direction:column;align-items:flex-start;gap:8px;">
      <span class="settings-label">ğŸ˜º ë‹‰ë„¤ì„</span>
      <div style="display:flex;gap:8px;width:100%;">
        <input id="nicknameInput" type="text" maxlength="12" placeholder="ë‹‰ë„¤ì„ ì…ë ¥ (ìµœëŒ€ 12ì)"
          style="flex:1;height:38px;border:2px solid var(--border);border-radius:12px;padding:0 12px;font-family:'Nunito',sans-serif;font-size:14px;font-weight:800;color:var(--text);background:var(--bg);outline:none;">
        <button onclick="saveNickname()" style="height:38px;padding:0 14px;border:none;border-radius:12px;background:linear-gradient(135deg,#ff6eb4,#ff9fd3);color:white;font-family:'Nunito',sans-serif;font-size:13px;font-weight:900;cursor:pointer;">ì €ì¥</button>
      </div>
    </div>
    <div class="settings-row">
      <span class="settings-label">ğŸŒ™ ë‚˜ì´íŠ¸ ëª¨ë“œ</span>
      <button class="toggle-btn" id="toggleNight" onclick="toggleSetting('night')"></button>
    </div>
    <div class="settings-row">
      <span class="settings-label">ğŸµ ë°°ê²½ìŒì•…</span>
      <button class="toggle-btn on" id="toggleBgm" onclick="toggleSetting('bgm')"></button>
    </div>
    <div class="settings-row">
      <span class="settings-label">ğŸ”Š íš¨ê³¼ìŒ</span>
      <button class="toggle-btn on" id="toggleSfx" onclick="toggleSetting('sfx')"></button>
    </div>
    <div class="settings-row">
      <span class="settings-label">ğŸ“³ ì§„ë™</span>
      <button class="toggle-btn on" id="toggleVib" onclick="toggleSetting('vib')"></button>
    </div>

    <div class="settings-section">ğŸ± ê³ ì–‘ì´ ìŠ¤í‚¨</div>
    <div class="skin-grid" id="skinGrid"></div>

    <div class="settings-section">ğŸ¨ ìƒ‰ìƒ í…Œë§ˆ</div>
    <div class="theme-grid" id="themeGrid"></div>

    <button class="settings-save" onclick="saveSettings()">ì €ì¥ ğŸ’¾</button>
  </div>
</div>

<!-- START -->
<div class="screen" id="startScreen">
  <span class="logo-emoji">ğŸ±</span>
  <div class="logo-title">ëƒ¥10</div>
  <div class="logo-sub">NUMBER PUZZLE</div>
  <div class="live-bar">
    <div style="display:flex;align-items:center;gap:8px"><div class="live-dot"></div><span class="live-txt">ì§€ê¸ˆ í”Œë ˆì´ ì¤‘</span></div>
    <span class="live-cnt" id="liveCnt">ë¡œë”©...</span>
  </div>
  <!-- ì¼ì¼ ì±Œë¦°ì§€ -->
  <div class="daily-challenge" id="dailyChallenge">
    <span class="dc-badge">ğŸ“… ì˜¤ëŠ˜ì˜ ë¯¸ì…˜</span>
    <span class="dc-text" id="dcText">ë¡œë”© ì¤‘...</span>
    <span class="dc-status" id="dcStatus">â¬œ</span>
  </div>
  <div class="rule-card">
    <div class="rule-item"><span class="ri">ğŸ‘†</span>ê³ ì–‘ì´ íƒ­ â†’ í•©ì´ <strong>10</strong>ì´ ë˜ë©´ ëƒ¥~âœ¨</div>
    <div class="rule-item"><span class="ri">â¬‡ï¸</span>ì‹œê°„ ì§€ë‚ ìˆ˜ë¡ ê³ ì–‘ì´ ìŸì•„ì§!</div>
    <div class="rule-item"><span class="ri">â±ï¸</span>60ì´ˆ ì•ˆì— ìµœëŒ€í•œ ë§ì´!</div>
  </div>
  <button class="btn-play" onclick="firstStart()">ğŸ¾ START!</button>
  <div style="margin-top:6px;text-align:center;font-size:12px;font-weight:800;color:var(--dim);">
    ğŸ˜º <span id="startNickname"></span> Â· <span onclick="openSettings()" style="cursor:pointer;text-decoration:underline;">ë‹‰ë„¤ì„ ë³€ê²½</span>
  </div>
  <div style="margin-top:8px;text-align:center;">
    <span onclick="openPrivacy()" style="font-size:11px;font-weight:800;color:var(--dim);letter-spacing:1px;cursor:pointer;text-decoration:underline;">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</span>
    &nbsp;Â·&nbsp;
    <a href="https://buymeacoffee.com/bang.a.can" target="_blank" style="font-size:11px;font-weight:800;color:#f7c948;text-decoration:none;">ğŸ§‹ ì»¤í”¼ í•œ ì”</a>
  </div>
  <div style="margin-top:6px;width:100%;min-height:50px;">
    <ins class="adsbygoogle" style="display:block;width:100%;height:50px;" data-ad-client="ca-pub-XXXXXXXXXXXXXXXX" data-ad-slot="XXXXXXXXXX" data-ad-format="auto"></ins>
    <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>
  </div>
</div>

<!-- GAME -->
<div class="screen hidden" id="gameScreen">
  <div class="top-hud">
    <div class="timer-ring-wrap">
      <svg width="72" height="72" viewBox="0 0 72 72">
        <circle class="tr-bg" cx="36" cy="36" r="30"/>
        <circle class="tr-fg" id="timerRing" cx="36" cy="36" r="30" stroke-dasharray="188.5" stroke-dashoffset="0"/>
      </svg>
      <div class="timer-n" id="timerNum">60</div>
    </div>
    <button class="restart-btn" onclick="confirmRestart()" title="ë‹¤ì‹œì‹œì‘">ğŸ”„</button>
    <div class="score-block">
      <div class="score-lbl">SCORE</div>
      <div class="score-val" id="scoreVal">0</div>
      <div class="combo-pill" id="comboPill">Ã—1</div>
    </div>
  </div>
  <div class="pvp-bar">
    <span class="pvp-name">ğŸ˜º</span>
    <span class="pvp-pts" id="pvpMyPts">0</span>
    <div class="pvp-track"><div class="pvp-me" id="pvpMyBar"></div><div class="pvp-opp" id="pvpOppBar"></div></div>
    <span class="pvp-pts" id="pvpOppPts">0</span>
    <span class="pvp-name" id="pvpOppName">ğŸ˜¼</span>
    <span class="pvp-status" id="pvpStatus">ğŸ’¨</span>
  </div>
  <div class="sum-bar" id="sumBar">
    <span class="sum-lbl">í•©ê³„</span>
    <span class="sum-num" id="sumNum">â€”</span>
    <span class="sum-tip" id="sumTip">ê³ ì–‘ì´ë¥¼ ê³¨ë¼ë´ ğŸ±</span>
  </div>
  <div class="grid-wrap" id="gridWrap"><div class="grid" id="grid"></div></div>
</div>

<!-- RESULT -->
<div class="screen hidden" id="resultScreen" onclick="handleResultTap(event)">
  <div class="res-emoji" id="resEmoji">ğŸ˜¸</div>
  <div class="res-top">GAME OVER</div>
  <div class="res-grade" id="resGrade"></div>
  <div class="res-score" id="resScore">0</div>
  <div class="res-sub">íƒ€ì¼ <b id="resTiles">0</b>ê°œ ì œê±°</div>
  <div class="res-rank" id="resRank"></div>
  <div class="res-best" id="resBest">BEST: <b>0</b></div>
  <div class="res-best-gap" id="resBestGap"></div>
  <div class="lb-card"><div class="lb-title">ğŸ† ì˜¤ëŠ˜ì˜ TOP 5</div><div id="lbList">ë¡œë”© ì¤‘...</div></div>
  <button class="btn-retry" onclick="instantRetry()">ğŸ”„ ë‹¤ì‹œí•˜ê¸°</button>
  <div class="retry-hint">í™”ë©´ ì•„ë¬´ë°ë‚˜ íƒ­í•´ë„ ì‹œì‘í•´ìš” âš¡</div>
  <div class="share-section">
    <div class="share-label">ê³µìœ í•˜ê¸°</div>
    <div class="share-grid">
      <button class="share-btn share-x"       onclick="shareToX()" title="X(íŠ¸ìœ„í„°)">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="white"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-4.714-6.231-5.401 6.231H2.744l7.737-8.858L1.999 2.25H8.08l4.253 5.622 5.91-5.622zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
      </button>
      <button class="share-btn share-threads"  onclick="shareToThreads()" title="Threads">
        <svg width="22" height="22" viewBox="0 0 192 192" fill="white"><path d="M141.537 88.988a66.667 66.667 0 0 0-2.518-1.143c-1.482-26.315-15.818-41.329-39.981-41.489h-.338c-14.425 0-26.435 6.163-33.803 17.38l13.052 8.953c5.519-8.38 14.197-10.171 20.753-10.171h.23c8.012.053 14.058 2.379 17.976 6.914 2.86 3.351 4.775 7.985 5.718 13.853-7.13-1.212-14.839-1.583-23.07-1.114-23.161 1.334-38.051 14.836-37.11 33.582.482 9.42 5.025 17.523 12.778 22.801 6.647 4.57 15.227 6.795 24.117 6.317 11.765-.631 20.996-5.145 27.438-13.415 4.893-6.282 7.985-14.409 9.345-24.603 5.607 3.384 9.758 7.953 12.03 13.526 3.86 9.365 4.083 24.762-7.974 36.82-10.63 10.626-23.42 15.231-42.685 15.365-21.32-.148-37.484-7.01-48.036-20.401C52.21 139.705 47.044 122.631 46.88 100c.164-22.631 5.33-39.705 15.36-50.768 10.552-13.39 26.716-20.252 48.036-20.4 21.467.149 37.957 7.038 49.056 20.486 5.445 6.625 9.524 14.97 12.146 24.853l15.329-4.078c-3.14-11.535-8.155-21.538-14.99-29.823C156.114 21.48 134.88 12.12 100.336 12L100 12l-.336.001C65.13 12.12 43.897 21.48 29.946 40.27 17.6 57.01 11.298 80.963 11.08 100v.02c.218 19.037 6.52 42.99 18.866 59.73C43.897 178.52 65.13 187.88 99.664 188l.336.001.336-.001c30.046-.2 51.26-8.051 66.772-24.512 17.176-18.207 16.556-40.935 10.938-54.923-4.006-9.711-11.69-17.672-21.509-22.577z"/></svg>
      </button>
      <button class="share-btn share-kakao"    onclick="shareToKakao()" title="ì¹´ì¹´ì˜¤í†¡">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="#3C1E1E"><path d="M12 3C6.477 3 2 6.477 2 10.8c0 2.7 1.612 5.073 4.07 6.518L5.03 21l4.583-2.857A11.63 11.63 0 0 0 12 18.6c5.523 0 10-3.477 10-7.8S17.523 3 12 3z"/></svg>
      </button>
      <button class="share-btn share-link"     onclick="copyLink()" title="ë§í¬ë³µì‚¬">ğŸ”—</button>
      <button class="share-btn share-native"   onclick="shareScore()" title="ë”ë³´ê¸°">ğŸ“¤</button>
    </div>
    <div class="share-labels-row">
      <span>X</span><span>Threads</span><span>ì¹´í†¡</span><span>ë§í¬ë³µì‚¬</span><span>ë”ë³´ê¸°</span>
    </div>
  </div>
  <div style="width:100%;min-height:50px;">
    <ins class="adsbygoogle" style="display:block;width:100%;height:50px;" data-ad-client="ca-pub-XXXXXXXXXXXXXXXX" data-ad-slot="XXXXXXXXXX" data-ad-format="auto"></ins>
    <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>
  </div>
</div>

<!-- ìµœê³ ì  ê²½ì‹  ì—°ì¶œ -->
<div class="best-burst hidden" id="bestBurst">
  <div class="best-burst-inner">ğŸ† ìµœê³ ì  ê²½ì‹ !</div>
</div>

<!-- íŠœí† ë¦¬ì–¼ (ì²« í”Œë ˆì´ì–´ë§Œ) -->
<div class="tut-ov hidden" id="tutOv" onclick="closeTut()">
  <div class="tut-box">
    <div class="tut-emoji">ğŸ±</div>
    <div class="tut-title">ì´ë ‡ê²Œ í•´ë´ìš”!</div>
    <div class="tut-step">1ï¸âƒ£ ìˆ«ì ê³ ì–‘ì´ë¥¼ <b>íƒ­</b>í•´ì„œ ì„ íƒ</div>
    <div class="tut-step">2ï¸âƒ£ ì„ íƒí•œ í•©ì´ <b>10</b>ì´ ë˜ë©´ ìë™ ì œê±°!</div>
    <div class="tut-step">3ï¸âƒ£ í•œë²ˆì— 3ê°œ ì´ìƒ â†’ <b>ë³´ë„ˆìŠ¤ ì ìˆ˜ ğŸ”¥</b></div>
    <div class="tut-step">4ï¸âƒ£ ì—°ì†ìœ¼ë¡œ ì„±ê³µí•˜ë©´ <b>ì½¤ë³´!</b></div>
    <button class="tut-btn" onclick="closeTut()">ì‹œì‘í•˜ê¸° ğŸ¾</button>
  </div>
</div>

<!-- ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ ëª¨ë‹¬ -->
<div class="settings-modal hidden" id="privacyModal" onclick="closePrivacyBg(event)">
  <div class="settings-sheet" style="max-height:80vh;overflow-y:auto;">
    <div class="settings-title">ğŸ”’ ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</div>
    <button class="settings-close" onclick="closePrivacy()">âœ•</button>
    <div style="font-size:12px;font-weight:700;color:var(--text);line-height:1.8;">
      <p style="margin-bottom:10px;color:var(--dim);">ì‹œí–‰ì¼: 2025ë…„ 1ì›” 1ì¼</p>

      <b>1. ìˆ˜ì§‘í•˜ëŠ” ì •ë³´</b>
      <p style="margin:6px 0 12px;">ëƒ¥10ì€ ë‹¤ìŒ ì •ë³´ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤:<br>
      - ê¸°ê¸° ê³ ìœ  ì‹ë³„ì (ëœë¤ ìƒì„±, ê°œì¸ íŠ¹ì • ë¶ˆê°€)<br>
      - ë‹‰ë„¤ì„ (ëœë¤ ìë™ ìƒì„±)<br>
      - ê²Œì„ ì ìˆ˜ ë° í”Œë ˆì´ ì‹œê°„</p>

      <b>2. ìˆ˜ì§‘ ëª©ì </b>
      <p style="margin:6px 0 12px;">- ì‹¤ì‹œê°„ ë¦¬ë”ë³´ë“œ ìš´ì˜<br>
      - ë™ì ‘ì ìˆ˜ í‘œì‹œ<br>
      - ê²Œì„ ì„œë¹„ìŠ¤ ê°œì„ </p>

      <b>3. ë³´ê´€ ê¸°ê°„</b>
      <p style="margin:6px 0 12px;">ì ìˆ˜ ë°ì´í„°ëŠ” ë‹¹ì¼ ê¸°ì¤€ìœ¼ë¡œ ê´€ë¦¬ë˜ë©°, ì„œë¹„ìŠ¤ ìš´ì˜ ëª©ì  ë‹¬ì„± í›„ íŒŒê¸°í•©ë‹ˆë‹¤.</p>

      <b>4. ì œ3ì ì œê³µ</b>
      <p style="margin:6px 0 12px;">ìˆ˜ì§‘ëœ ì •ë³´ëŠ” Firebase(Google LLC)ì— ì €ì¥ë©ë‹ˆë‹¤. Googleì˜ ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ì´ ì ìš©ë©ë‹ˆë‹¤.</p>

      <b>5. ì´ìš©ì ê¶Œë¦¬</b>
      <p style="margin:6px 0 12px;">ì´ìš©ìëŠ” ì–¸ì œë“ ì§€ ë³¸ì¸ì˜ ë°ì´í„° ì‚­ì œë¥¼ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•± ì„¤ì •ì—ì„œ ë°ì´í„° ì´ˆê¸°í™”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>

      <b>6. ë¬¸ì˜</b>
      <p style="margin:6px 0 12px;">ê°œì¸ì •ë³´ ê´€ë ¨ ë¬¸ì˜ëŠ” ì„œë¹„ìŠ¤ ë‚´ ë¬¸ì˜ ì±„ë„ì„ ì´ìš©í•´ ì£¼ì„¸ìš”.</p>
    </div>
    <button class="settings-save" onclick="closePrivacy()">í™•ì¸ âœ…</button>
  </div>
</div>

<!-- ì¬ì‹œì‘ í™•ì¸ ëª¨ë‹¬ -->
<div class="restart-modal hidden" id="restartModal">
  <div class="restart-box">
    <div style="font-size:36px">ğŸ”„</div>
    <div style="font-size:17px;font-weight:900;color:var(--text);">ë‹¤ì‹œ ì‹œì‘í• ê¹Œìš”?</div>
    <div style="font-size:12px;font-weight:800;color:var(--dim);">ì§€ê¸ˆ ì ìˆ˜ê°€ ì‚¬ë¼ì ¸ìš”!</div>
    <div style="display:flex;gap:10px;width:100%;margin-top:4px;">
      <button onclick="cancelRestart()" style="flex:1;height:44px;border:2px solid var(--border);border-radius:14px;background:white;font-family:'Nunito',sans-serif;font-size:15px;font-weight:900;color:var(--dim);cursor:pointer;">ì·¨ì†Œ</button>
      <button onclick="doRestart()" style="flex:1;height:44px;border:none;border-radius:14px;background:linear-gradient(135deg,#ff6eb4,#ff9fd3);font-family:'Nunito',sans-serif;font-size:15px;font-weight:900;color:white;cursor:pointer;box-shadow:0 4px 0 var(--pink-dark);">ë‹¤ì‹œì‹œì‘!</button>
    </div>
  </div>
</div>

<div class="cd-ov hidden" id="cdOv">
  <div class="cd-n" id="cdN">3</div>
  <div class="cd-sub">ê³ ì–‘ì´ë“¤ ì¶œë™ ì¤€ë¹„ ì¤‘...</div>
</div>
<div class="go-flash hidden" id="goFlash"><div class="go-txt">GO! ğŸ±</div></div>

<!-- Firebase -->
<script type="module">
import{initializeApp}from"https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import{getDatabase,ref,set,get,push,onValue,query,orderByChild,limitToLast}from"https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";
const cfg={apiKey:"AIzaSyD3XutJt1rNdunlkq_HNYZI28ZKxhCQN8U",authDomain:"nyang10-85344.firebaseapp.com",databaseURL:"https://nyang10-85344-default-rtdb.firebaseio.com",projectId:"nyang10-85344",storageBucket:"nyang10-85344.firebasestorage.app",messagingSenderId:"404004970168",appId:"1:404004970168:web:83f9ca635dabd038441e4d"};
const app=initializeApp(cfg);const db=getDatabase(app);

// â”€â”€ ê¸°ê¸° ê³ ìœ  ID (í•œ ë²ˆ ìƒì„± í›„ localStorageì— ê³ ì •) â”€â”€
function getDeviceId(){
  let id=localStorage.getItem('n10_uid');
  if(!id){id='u_'+Date.now().toString(36)+Math.random().toString(36).slice(2,7);localStorage.setItem('n10_uid',id);}
  return id;
}
function getDeviceName(){
  let n=localStorage.getItem('n10_name');
  if(!n){n='ëƒ¥ì§‘ì‚¬'+Math.floor(Math.random()*9000+1000);localStorage.setItem('n10_name',n);}
  return n;
}
const DEVICE_ID=getDeviceId();
const DEVICE_NAME=getDeviceName();

function todayKey(){const d=new Date();return`${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;}
const tKey=todayKey();

// â”€â”€ ë™ì ‘ì ìˆ˜ ì‹¤ì‹œê°„ â”€â”€
const pRef=push(ref(db,'players'));set(pRef,{t:Date.now()});setTimeout(()=>set(pRef,null),60000);
onValue(ref(db,'players'),snap=>{const cnt=snap.exists()?Object.keys(snap.val()).length:1;const el=document.getElementById('liveCnt');if(el)el.textContent=Math.max(cnt,1)+'ëª…';});

// â”€â”€ ì˜¤ëŠ˜ ìµœê³  ê¸°ë¡ (PVPìš©) â”€â”€
onValue(query(ref(db,`scores/${tKey}`),orderByChild('score'),limitToLast(1)),snap=>{
  if(!snap.exists())return;
  snap.forEach(c=>{window._todayBest=c.val().score;});
},{onlyOnce:true});

// â”€â”€ ì ìˆ˜ ì œì¶œ: ê¸°ê¸°ë³„ ë² ìŠ¤íŠ¸ë§Œ ì €ì¥ (ë®ì–´ì“°ê¸°) â”€â”€
window.fbSubmit=async s=>{
  const userRef=ref(db,`scores/${tKey}/${DEVICE_ID}`);
  const snap=await get(userRef);
  const prev=snap.exists()?snap.val().score:0;
  if(s>prev){
    const latestName=localStorage.getItem('n10_name')||DEVICE_NAME;
    set(userRef,{name:latestName,score:s,t:Date.now()});
  }
};

// â”€â”€ ë¦¬ë”ë³´ë“œ ì‹¤ì‹œê°„ êµ¬ë… (ê²°ê³¼ í™”ë©´ì—ì„œ ê³„ì† ì—…ë°ì´íŠ¸) â”€â”€
let lbUnsub=null;
window.fbLeaderboard=myScore=>{
  // ê¸°ì¡´ êµ¬ë… í•´ì œ
  if(lbUnsub){lbUnsub();lbUnsub=null;}
  const q=query(ref(db,`scores/${tKey}`),orderByChild('score'),limitToLast(20));
  lbUnsub=onValue(q,snap=>{
    if(!snap.exists()){document.getElementById('lbList').textContent='ì•„ì§ ê¸°ë¡ ì—†ìŒ';return;}
    let arr=[];snap.forEach(c=>arr.push({...c.val(),uid:c.key}));
    arr.sort((a,b)=>b.score-a.score);
    const top5=arr.slice(0,5);
    document.getElementById('lbList').innerHTML=top5.map((e,i)=>{
      const isMe=e.uid===DEVICE_ID;
      const g=[...GRADES].reverse().find(g=>e.score>=g.min)||GRADES[0];
      return`<div class="lb-row ${isMe?'me':''}"><span class="lb-rank">${['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰','4ï¸âƒ£','5ï¸âƒ£'][i]}</span><span class="lb-name">${isMe?'ğŸ˜º ë‚˜ ('+e.name+')':e.name}</span><span style="font-size:10px;color:var(--dim);margin-right:4px;">${g.e}${g.t}</span><span class="lb-pts">${e.score}ì </span></div>`;
    }).join('');
    const myIdx=arr.findIndex(e=>e.uid===DEVICE_ID);
    const rankEl=document.getElementById('resRank');
    if(rankEl&&myIdx>=0){
      const pct=Math.round(((arr.length-myIdx)/arr.length)*100);
      rankEl.textContent=`ì „ì²´ ${arr.length}ëª… ì¤‘ ìƒìœ„ ${pct}% Â· ${myIdx+1}ìœ„`;
    }
  });
};

// ê²°ê³¼ í™”ë©´ ë‹«í ë•Œ êµ¬ë… í•´ì œ
window.stopLbListen=()=>{if(lbUnsub){lbUnsub();lbUnsub=null;}};
</script>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ë´‡ ë‹‰ë„¤ì„ í’€ â€” ì§„ì§œ í•œêµ­ ìœ ì € ëŠë‚Œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BOT_NAMES=[
  'ê³ ì–‘ì´ì¡°ì•„','ìƒˆë²½ì„¸ì‹œ','ê°ìì¹©','ã…ã…‡','ë°¥ë¨¹ëŠ”ì¤‘','ì¡¸ë ¤ì£½ê² ë‹¤','ëƒ¥ëƒ¥ì´ì§‘ì‚¬','ì»¤í”¼í•œì”',
  'í‡´ê·¼í•˜ê³ ì‹¶ë‹¤','ì§‘ê°€ê³ ì‹¶ì–´','ë°°ê³ íŒŒ','ì‹¬ì‹¬í•œê³ ì–‘ì´','ì•¼ì˜¹ì´ì•„ë¹ ','ê³ ì–‘ì´ì—„ë§ˆ','ë‚®ì ìëŠ”ì¤‘',
  'ì›”ìš”ì¼ì‹«ì–´','ê¸ˆìš”ì¼ë§Œì„¸','ì¹˜í‚¨ë¨¹ì','í”¼ìì¡°ì•„','ë¼ë©´ë“ì´ëŠ”ì¤‘','ë²„ë¸”í‹°','íƒ•í›„ë£¨',
  'í¸ì˜ì ì•Œë°”','ì•¼ê·¼ì¤‘','ì¬íƒê·¼ë¬´','ì§‘ìˆœì´','ì§‘ëŒì´','ì£¼ë§ì§‘ì‚¬','ê·€ì°¨ë‹ˆì¦˜',
  'ê³ ì–‘ì´ì„¸ë§ˆë¦¬','ëƒ¥ì´ë„¤ì§‘','í„¸ë­‰ì¹˜','ì•¼ì˜¹ì´','ê¹œëƒ¥ì´','í°ë‘¥ì´ì§‘ì‚¬','ì¹˜ì¦ˆëƒ¥',
  'ê³ ë“±ì–´ëƒ¥','ì½”ìˆì§‘ì‚¬','í˜ë¥´ì‹œì•ˆ','ëŸ¬ì‹œì•ˆë¸”ë£¨','ëƒ¥ì§‘ì‚¬ì¼ê¸°','ê³ ì–‘ì´ì¹´í˜',
  'ìˆ¨ìˆ¨ì§‘','ìº£íƒ€ì›Œ','ëƒ¥ì´ê°„ì‹','ì°¸ì¹˜ìº”','ì¸„ë¥´ì¡°ì•„','ìº£ë‹™ì¤‘ë…',
  'ì¡¸ì—…í•˜ê³ ì‹¶ë‹¤','ì‹œí—˜ëë‚¬ë‹¤','ì•Œë°”ë›°ëŠ”ì¤‘','ëŒ€í•™ìƒì§‘ì‚¬','ì§ì¥ì¸ëƒ¥ì§‘ì‚¬',
  'ì„œìš¸ëƒ¥ì´','ë¶€ì‚°ì§‘ì‚¬','ì œì£¼ë„ê³ ì–‘ì´','ê²½ê¸°ë„ì§‘ì‚¬','ì¸ì²œëƒ¥ì´',
  'ìƒˆë²½ê°ì„±','ë°¤ì‚°ì±…','ë‹¬ë°¤ëƒ¥ì´','ë³„ë³´ëŠ”ì§‘ì‚¬','êµ¬ë¦„ì´ì§‘ì‚¬',
  'ë³µì‹¤ì´ì•„ë¹ ','ëª½ì´ì—„ë§ˆ','ì½©ì´ì§‘ì‚¬','ë‘ë¶€ëƒ¥','ìˆœë‘ë¶€','ëœì¥ì°Œê°œ',
  'zzzì¤‘','ë©ë•Œë¦¬ëŠ”ì¤‘','ìœ íŠœë¸Œë³´ëŠ”ì¤‘','ë„·í”Œì§‘ì‚¬','ê²Œì„í•˜ëŠ”ì§‘ì‚¬',
  'ê³ ì–‘ì´ì‚¬ì§„ì‘ê°€','ëƒ¥ìŠ¤íƒ€ê·¸ë¨','ì§‘ì‚¬ì¼ê¸°','ëƒ¥ì´ë¡œê·¸','ê³ ì–‘ì´ë¸Œì´ë¡œê·¸',
  'ì´ë¦„ë­í•˜ì§€','ë‹‰ë„¤ì„ê³ ë¯¼ì¤‘','ê·¸ëƒ¥ì§‘ì‚¬','í‰ë²”í•œì§‘ì‚¬','ì†Œì‹¬í•œì§‘ì‚¬',
  'ì ê·¹ì ì¸ëƒ¥ì´','í™œë°œí•œì§‘ì‚¬','ì¡°ìš©í•œê³ ì–‘ì´','ì‹œë„ëŸ¬ìš´ì§‘ì‚¬','ìˆ˜ë‹¤ìŸì´ëƒ¥',
  'ì•¼ì‹ë¨¹ëŠ”ì¤‘','ë‹¤ì´ì–´íŠ¸ì¤‘ì¸ì§‘ì‚¬','í—¬ìŠ¤í•˜ëŠ”ëƒ¥ì´','ëŸ¬ë‹ì§‘ì‚¬','ë“±ì‚°ê³ ì–‘ì´',
  'ì±…ì½ëŠ”ì§‘ì‚¬','ìŒì•…ë“£ëŠ”ëƒ¥ì´','ê·¸ë¦¼ê·¸ë¦¬ëŠ”ì§‘ì‚¬','ì‚¬ì§„ì°ëŠ”ëƒ¥ì´','ìš”ë¦¬í•˜ëŠ”ì§‘ì‚¬',
];

function randBotName(){
  return BOT_NAMES[Math.floor(Math.random()*BOT_NAMES.length)];
}

// ë´‡ ëª©í‘œì ìˆ˜ â€” ì •ê·œë¶„í¬ ê·¼ì‚¬ (í‰ê·  250, í‘œì¤€í¸ì°¨ 120)
function randBotTarget(){
  // Box-Muller ë³€í™˜ìœ¼ë¡œ ì •ê·œë¶„í¬
  const u1=Math.random(), u2=Math.random();
  const z=Math.sqrt(-2*Math.log(u1))*Math.cos(2*Math.PI*u2);
  const score=Math.round(250 + z*120);
  return Math.max(60, Math.min(600, score)); // 60~600 ì‚¬ì´ë¡œ í´ë¨í”„
}
let audioCtx=null, sfxMuted=false, tickInterval=null;

function getCtx(){
  if(!audioCtx) audioCtx=new(window.AudioContext||window.webkitAudioContext)();
  if(audioCtx.state==='suspended') audioCtx.resume();
  return audioCtx;
}

function playTone(freq, type='sine', duration=0.12, vol=0.3, delay=0){
  if(sfxMuted)return;  // íš¨ê³¼ìŒë§Œ ì²´í¬
  try{
    const ctx=getCtx();
    const osc=ctx.createOscillator();
    const gain=ctx.createGain();
    osc.connect(gain);gain.connect(ctx.destination);
    osc.type=type;osc.frequency.setValueAtTime(freq,ctx.currentTime+delay);
    gain.gain.setValueAtTime(vol,ctx.currentTime+delay);
    gain.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+delay+duration);
    osc.start(ctx.currentTime+delay);osc.stop(ctx.currentTime+delay+duration+0.01);
  }catch(e){}
}

function playBGMTone(freq, type='sine', duration=0.18, vol=0.06){
  if(!settings.bgm)return;  // BGMë§Œ ì²´í¬
  try{
    const ctx=getCtx();
    const osc=ctx.createOscillator();
    const gain=ctx.createGain();
    osc.connect(gain);gain.connect(ctx.destination);
    osc.type=type;osc.frequency.value=freq;
    gain.gain.setValueAtTime(vol,ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+duration);
    osc.start(ctx.currentTime);osc.stop(ctx.currentTime+duration+0.01);
  }catch(e){}
}

function playChord(freqs, type='sine', duration=0.15, vol=0.25){
  freqs.forEach((f,i)=>playTone(f,type,duration,vol,i*0.03));
}

// ğŸµ íƒ€ì¼ ì„ íƒ â€” ê²½ì¾Œí•œ í‹±
function sndSelect(num){
  // pitch based on number
  const base=300+num*40;
  playTone(base,'triangle',0.08,0.2);
}

// âœ… í•© 10 ì„±ê³µ â€” ìƒìŠ¹ íŒ¡íŒŒë ˆ
function sndSuccess(combo){
  if(combo>=5){
    // 5ì½¤ë³´ ì´ìƒ: í™”ë ¤í•œ ì•„ë¥´í˜ì§€ì˜¤
    [523,659,784,1047,1319].forEach((f,i)=>playTone(f,'sine',0.18,0.3,i*0.05));
  } else if(combo>=3){
    // 3ì½¤ë³´: ì‹ ë‚˜ëŠ” 3í™”ìŒ
    playChord([523,659,784],'sine',0.2,0.3);
    playTone(1047,'sine',0.25,0.25,0.1);
  } else {
    // ì¼ë°˜ ì„±ê³µ: ê²½ì¾Œí•œ 2ìŒ
    playTone(523,'sine',0.1,0.25);
    playTone(784,'sine',0.15,0.3,0.08);
  }
}

// âŒ ì˜¤ë‹µ â€” ì‹¤íŒ¨ìŒ
function sndFail(){
  playTone(200,'sawtooth',0.15,0.3);
  playTone(150,'sawtooth',0.2,0.25,0.1);
}

// â° ë§‰íŒ 10ì´ˆ â€” ê¸´ë°•í•œ í‹±
function startTickSound(){
  clearInterval(tickInterval);
  tickInterval=setInterval(()=>{
    if(!sfxMuted) playTone(880,'square',0.05,0.15);
  },500);
}
function stopTickSound(){clearInterval(tickInterval);}

// ğŸ® ê²Œì„ ì‹œì‘ â€” ê²½ì¾Œí•œ íŒ¡íŒŒë ˆ
function sndStart(){
  [330,440,523,659].forEach((f,i)=>playTone(f,'sine',0.12,0.25,i*0.06));
}

// ğŸ’€ ê²Œì„ ì˜¤ë²„ â€” í•˜ê°• ë§ˆë¬´ë¦¬
function sndGameOver(){
  stopTickSound();
  [523,440,349,262].forEach((f,i)=>playTone(f,'triangle',0.2,0.3,i*0.1));
}

// ğŸµ BGM ENGINE â€” Web Audio ìŠ¤ì¼€ì¤„ë§ (ë©”ì¸ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹ ì—†ìŒ)
let bgmRunning=false, bgmNextTime=0, bgmStep=0, bgmRafId=null;
const BGM_NOTES=[523,659,784,659,523,523,659,784,880,784,659,523,440,523,659,523];
const BGM_INTERVAL=0.22; // ì´ˆ ë‹¨ìœ„

function scheduleBGM(){
  if(!bgmRunning||!settings.bgm)return;
  const ctx=getCtx();
  // 0.3ì´ˆ ì•ì„ ë¯¸ë¦¬ ìŠ¤ì¼€ì¤„
  while(bgmNextTime < ctx.currentTime + 0.3){
    try{
      const osc=ctx.createOscillator();
      const gain=ctx.createGain();
      osc.connect(gain);gain.connect(ctx.destination);
      osc.type='sine';
      osc.frequency.value=BGM_NOTES[bgmStep%BGM_NOTES.length];
      gain.gain.setValueAtTime(0.06, bgmNextTime);
      gain.gain.exponentialRampToValueAtTime(0.001, bgmNextTime+0.18);
      osc.start(bgmNextTime);osc.stop(bgmNextTime+0.19);
    }catch(e){}
    bgmNextTime+=BGM_INTERVAL;
    bgmStep++;
  }
  bgmRafId=requestAnimationFrame(scheduleBGM);
}
function startBGM(){
  if(bgmRunning||!settings.bgm)return;
  bgmRunning=true;
  try{bgmNextTime=getCtx().currentTime+0.05;}catch(e){return;}
  scheduleBGM();
}
function stopBGM(){
  bgmRunning=false;
  if(bgmRafId){cancelAnimationFrame(bgmRafId);bgmRafId=null;}
}

// ğŸ”Š ìš°ì¸¡ ìƒë‹¨ ë®¤íŠ¸ë²„íŠ¼ â€” íš¨ê³¼ìŒë§Œ í† ê¸€
function toggleMute(){
  settings.sfx=!settings.sfx;
  sfxMuted=!settings.sfx;
  document.getElementById('muteBtn').textContent=sfxMuted?'ğŸ”‡':'ğŸ”Š';
  if(!sfxMuted) playTone(880,'sine',0.1,0.2);
  saveSettingsData();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CAT_SKINS=[
  {id:'classic', emojis:['','ğŸ˜º','ğŸ˜¸','ğŸ˜»','ğŸ±','ğŸ˜¹','ğŸ™€','ğŸ˜¿','ğŸ˜¾','ğŸˆ'], color:'#ffadad', label:'ê¸°ë³¸'},
  {id:'fancy',   emojis:['','ğŸ±','ğŸ¦','ğŸ¯','ğŸ»','ğŸ¼','ğŸ¨','ğŸ¦Š','ğŸº','ğŸ¸'], color:'#b5ead7', label:'ë™ë¬¼'},
  {id:'star',    emojis:['','â­','ğŸŒŸ','ğŸ’«','âœ¨','ğŸŒ™','â˜€ï¸','ğŸŒˆ','ğŸ€','ğŸ¯'], color:'#a8e6f0', label:'ë³„ë¹›'},
  {id:'food',    emojis:['','ğŸ','ğŸŠ','ğŸ‹','ğŸ‡','ğŸ“','ğŸ«','ğŸ‘','ğŸ’','ğŸ¥'], color:'#fdffb6', label:'ê³¼ì¼'},
  {id:'pure',    emojis:['','','','','','','','','',''],                   color:'#c5b8ff', label:'ìˆ«ìë§Œ', pure:true},
];
const COLOR_THEMES=[
  {id:'pink',   bg:'#fef6ff', pink:'#ff6eb4', pinkDark:'#d94d96', border:'#f0d4f0', label:'ğŸŒ¸'},
  {id:'mint',   bg:'#f0fffd', pink:'#4ecdc4', pinkDark:'#2ba89f', border:'#b5f0ec', label:'ğŸŒ¿'},
  {id:'sky',    bg:'#f0f8ff', pink:'#4a90d9', pinkDark:'#2c6db5', border:'#b8d9f5', label:'ğŸ©µ'},
  {id:'purple', bg:'#f5f0ff', pink:'#8b5cf6', pinkDark:'#6d28d9', border:'#d8c8ff', label:'ğŸ’œ'},
  {id:'peach',  bg:'#fff8f0', pink:'#ff8c42', pinkDark:'#d96520', border:'#ffd5b0', label:'ğŸ‘'},
];

let settings={bgm:true, sfx:true, vib:true, night:false, skin:'classic', theme:'pink'};

function loadSettingsData(){
  try{const s=JSON.parse(localStorage.getItem('n10_settings')||'{}');Object.assign(settings,s);}catch(e){}
  applyTheme(settings.theme);
  applyNight(settings.night);
  sfxMuted=!settings.sfx;
  document.getElementById('muteBtn').textContent=sfxMuted?'ğŸ”‡':'ğŸ”Š';
  updateStartNickname();
}
function saveSettingsData(){
  localStorage.setItem('n10_settings',JSON.stringify(settings));
}

function applyTheme(id){
  const t=COLOR_THEMES.find(t=>t.id===id)||COLOR_THEMES[0];
  const r=document.documentElement.style;
  // ë‚˜ì´íŠ¸ëª¨ë“œ ì¤‘ì—” bg/borderëŠ” night CSSê°€ ë‹´ë‹¹ â€” pink ê³„ì—´ë§Œ ë®ì–´ì”€
  if(!settings.night){
    r.setProperty('--bg',t.bg);
    r.setProperty('--border',t.border);
  }
  r.setProperty('--pink',t.pink);
  r.setProperty('--pink-dark',t.pinkDark);
}

function applyNight(on){
  document.body.classList.toggle('night',on);
  // ë‚˜ì´íŠ¸ OFFë¡œ ë°”ë€Œë©´ í…Œë§ˆ bg/border ì¬ì ìš©
  if(!on) applyTheme(settings.theme);
  else{
    // ë‚˜ì´íŠ¸ ON: bg/border ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì œê±° â†’ CSS night í´ë˜ìŠ¤ê°€ ë‹´ë‹¹
    document.documentElement.style.removeProperty('--bg');
    document.documentElement.style.removeProperty('--border');
  }
}

function openSettings(){
  // í† ê¸€ ë²„íŠ¼ ìƒíƒœ
  ['bgm','sfx','vib','night'].forEach(k=>{
    const el=document.getElementById('toggle'+k.charAt(0).toUpperCase()+k.slice(1));
    if(el)el.className='toggle-btn'+(settings[k]?' on':'');
  });
  // ìŠ¤í‚¨ ê·¸ë¦¬ë“œ
  const sg=document.getElementById('skinGrid');
  sg.innerHTML=CAT_SKINS.map(s=>{
    const locked=!isSkinUnlocked(s.id);
    const hint=locked?(SKIN_UNLOCK[s.id]?.hint||''):'';
    return`<div class="skin-opt${settings.skin===s.id?' active':''}${locked?' locked':''}" onclick="${locked?`showToast('ğŸ”’ ${hint}');return;`:``}selectSkin('${s.id}')" style="background:${s.color}" data-skin="${s.id}" title="${hint}">
      ${s.pure?'':'<div class="s-emoji">'+s.emojis[1]+'</div>'}
      <div class="s-num" style="${s.pure?'font-size:26px':''}">3</div>
    </div>`;
  }).join('');
  // í…Œë§ˆ ê·¸ë¦¬ë“œ
  const tg=document.getElementById('themeGrid');
  tg.innerHTML=COLOR_THEMES.map(t=>`
    <div class="theme-opt${settings.theme===t.id?' active':''}" onclick="selectTheme('${t.id}')" style="background:${t.bg};border-color:${settings.theme===t.id?t.pink:'#f0d4f0'}" data-theme="${t.id}">
      <span style="font-size:20px">${t.label}</span>
    </div>
  `).join('');
  document.getElementById('settingsModal').classList.remove('hidden');
  const ni=document.getElementById('nicknameInput');
  if(ni) ni.value=localStorage.getItem('n10_name')||'';
}

function closeSettings(){document.getElementById('settingsModal').classList.add('hidden');}
function closeSettingsBg(e){if(e.target===document.getElementById('settingsModal'))closeSettings();}

function toggleSetting(key){
  settings[key]=!settings[key];
  const btn=document.getElementById('toggle'+key.charAt(0).toUpperCase()+key.slice(1));
  btn.className='toggle-btn'+(settings[key]?' on':'');
  if(key==='sfx'){
    sfxMuted=!settings.sfx;
    document.getElementById('muteBtn').textContent=sfxMuted?'ğŸ”‡':'ğŸ”Š';
    if(!sfxMuted) playTone(880,'sine',0.1,0.2);
  }
  if(key==='bgm'){
    settings.bgm?startBGM():stopBGM();
  }
  if(key==='night'){
    applyNight(settings.night);
  }
}

function selectSkin(id){
  settings.skin=id;
  document.querySelectorAll('.skin-opt').forEach(el=>{
    el.classList.toggle('active',el.dataset.skin===id);
  });
  // ì„ íƒ ì¦‰ì‹œ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
  const skin=CAT_SKINS.find(s=>s.id===id);
  if(skin)window._curSkin=skin;
}

function selectTheme(id){
  settings.theme=id;
  document.querySelectorAll('.theme-opt').forEach(el=>{
    const t=COLOR_THEMES.find(t=>t.id===el.dataset.theme);
    el.classList.toggle('active',el.dataset.theme===id);
    if(t)el.style.borderColor=el.dataset.theme===id?t.pink:'#f0d4f0';
  });
  applyTheme(id);
}

function saveNickname(){
  const input=document.getElementById('nicknameInput');
  const val=input.value.trim();
  if(!val){showToast('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì¤˜ìš” ğŸ±');return;}
  localStorage.setItem('n10_name',val);
  updateStartNickname();
  showToast('ë‹‰ë„¤ì„ ì €ì¥! ğŸ˜º '+val);
  if(settings.sfx) playTone(660,'sine',0.1,0.25);
}

function updateStartNickname(){
  const el=document.getElementById('startNickname');
  if(el) el.textContent=localStorage.getItem('n10_name')||'ëƒ¥ì§‘ì‚¬';
}

function saveSettings(){
  saveSettingsData();
  // í˜„ì¬ ìŠ¤í‚¨ ì ìš©
  const skin=CAT_SKINS.find(s=>s.id===settings.skin)||CAT_SKINS[0];
  window._curSkin=skin;
  closeSettings();
  if(settings.sfx) playTone(660,'sine',0.1,0.25);
}

// ì§„ë™ ë˜í¼ (ì„¤ì • ë°˜ì˜)
function vibrate(pattern){
  if(settings.vib&&navigator.vibrate)navigator.vibrate(pattern);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const COLS=4,ROWS=5,TARGET=10,DURATION=60,CIRC=188.5;
const CAT_EMOJIS=['','ğŸ˜º','ğŸ˜¸','ğŸ˜»','ğŸ±','ğŸ˜¹','ğŸ™€','ğŸ˜¿','ğŸ˜¾','ğŸˆ']; // fallback
function getCatEmoji(v){
  const skin=window._curSkin||{emojis:CAT_EMOJIS};
  if(skin.pure)return '';
  return skin.emojis[v]||CAT_EMOJIS[v]||'ğŸ±';
}
const W={easy:[0,4,5,10,11,13,11,8,4,2],mid:[0,4,5,9,11,12,10,6,3,2],hard:[0,3,4,8,10,12,9,6,4,2]};
const GRADES=[
  {min:0,   e:'ğŸ˜µ',t:'ëƒ¥ì•Œë°”ìƒ',          bg:'#e8f4ff',c:'#4a90c4'},
  {min:150, e:'ğŸ« ',t:'ì§‘ì‚¬ ì§€ë§ìƒ',        bg:'#fff3e8',c:'#d07020'},
  {min:350, e:'ğŸ˜¤',t:'ì§‘ì‚¬ê³„ ì¤‘ê°„ë³´ìŠ¤',    bg:'#ffe8f5',c:'#d94d96'},
  {min:600, e:'ğŸ¤©',t:'ì§‘ì‚¬ê³„ ë ˆì „ë“œ',      bg:'#f3e8ff',c:'#7c3aed'},
  {min:900, e:'ğŸ«¡',t:'ëƒ¥ì‹ ë‚´ë¦¼ ë°›ì€ ì',  bg:'#fff8d6',c:'#b08000'},
  {min:2000,e:'ğŸ‘¼',t:'í™˜ìƒí•œ ê³ ì–‘ì´',      bg:'#ffe0f0',c:'#c0006a'},
];
const SMS=[{v:50,m:'ğŸ‰ 50ì !'},{v:100,m:'ğŸ’¥ 100ì !!'},{v:200,m:'ğŸ‘‘ 200ì  ì „ì„¤'}];
const CMS=[{v:3,m:'ğŸ”¥ ì½¤ë³´ 3!'},{v:5,m:'ğŸ’£ ì½¤ë³´ 5!!'},{v:10,m:'ğŸŒŸ ì½¤ë³´ 10!!!'}];

let board=[],sel=[],score=0,cleared=0,combo=0,timeLeft=DURATION,
    running=false,ticker=null,cTimer=null,pTimer=null,oppTimer=null,
    best=+localStorage.getItem('n10best')||0,tid=0,
    dSMS=new Set(),dCMS=new Set(),oppScore=0,dc3hits=0;

function wrand(w){let t=w.reduce((a,b)=>a+b,0),r=Math.random()*t;for(let i=1;i<=9;i++){r-=w[i];if(r<=0)return i;}return 5;}
function phase(){if(timeLeft>40)return'easy';if(timeLeft>15)return'mid';return'hard';}
function mkTile(forceEasy=false){return{v:wrand(forceEasy?W.easy:W[phase()]),id:tid++};}
function initBoard(){
  board=[];
  // ê°€ëŠ¥í•œ í˜ì–´ í’€ (í•©ì´ 10ì¸ ì¡°í•© ì „ì²´)
  const pairPool=[[1,9],[2,8],[3,7],[4,6],[5,5],[1,9],[2,8],[3,7],[4,6],[5,5],[1,9],[2,8]];
  // ì…”í”Œ í›„ 8ìŒ ëœë¤ ì„ íƒ
  for(let i=pairPool.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[pairPool[i],pairPool[j]]=[pairPool[j],pairPool[i]];}
  const chosen=pairPool.slice(0,8);
  let flat=[];chosen.forEach(p=>{flat.push(p[0],p[1]);});
  // flat í•œ ë²ˆ ë” ì…”í”Œ
  for(let i=flat.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[flat[i],flat[j]]=[flat[j],flat[i]];}
  let pi=0;
  for(let r=0;r<ROWS;r++){board[r]=[];for(let c=0;c<COLS;c++){
    if(pi<flat.length){board[r][c]={v:flat[pi++],id:tid++};}
    else{board[r][c]=mkTile(true);}
  }}
}

function getCell(r,c){return document.getElementById('gridWrap').querySelector(`.grid-cell[data-pos="${r}-${c}"]`);}

function makeTileInner(t){
  const emoji=getCatEmoji(t.v);
  const isPure=window._curSkin&&window._curSkin.pure;
  return `<div class="ti">${emoji&&!isPure?`<div class="t-emoji">${emoji}</div>`:''}<span class="tnum"${isPure?' style="font-size:clamp(30px,9vw,42px)"':''}>${t.v}</span></div>`;
}

// ìµœì´ˆ 1íšŒ ë˜ëŠ” ê²Œì„ ì‹œì‘ì‹œ ì „ì²´ ê·¸ë¦¬ë“œ êµ¬ì„±
function buildGrid(){
  const g=document.getElementById('grid');
  g.innerHTML='';
  // ì´ë²¤íŠ¸ ìœ„ì„: ê·¸ë¦¬ë“œ ì „ì²´ì— í´ë¦­ í•˜ë‚˜ë§Œ ë“±ë¡
  const newG=g.cloneNode(false);
  g.parentNode.replaceChild(newG,g);
  newG.addEventListener('click',e=>{
    const cell=e.target.closest('.grid-cell');
    if(!cell)return;
    const pos=cell.dataset.pos.split('-');
    onTap(+pos[0],+pos[1]);
  });
  for(let r=0;r<ROWS;r++)for(let c=0;c<COLS;c++){
    const cell=document.createElement('div');
    cell.className='grid-cell';
    cell.dataset.pos=`${r}-${c}`;
    const t=board[r][c];
    if(t){
      const el=document.createElement('div');
      el.className=`tile t${t.v}`;
      el.dataset.id=t.id;
      el.innerHTML=makeTileInner(t);
      cell.appendChild(el);
    }
    newG.appendChild(cell);
  }
}

// ì„ íƒ ìƒíƒœë§Œ ì—…ë°ì´íŠ¸ (íƒ­í•  ë•Œë§ˆë‹¤)
function renderSelection(){
  for(let r=0;r<ROWS;r++)for(let c=0;c<COLS;c++){
    const cell=getCell(r,c);
    if(!cell)continue;
    const tile=cell.querySelector('.tile');
    if(!tile)continue;
    tile.classList.toggle('selected',sel.some(s=>s.r===r&&s.c===c));
  }
}

// ë§ì¶˜ íƒ€ì¼ë§Œ ì œê±° â†’ ìœ„ íƒ€ì¼ ìŠ¬ë¼ì´ë“œ ë‹¤ìš´ â†’ ìƒˆ íƒ€ì¼ ìœ„ì—ì„œ ë‚™í•˜
function animateRemoveAndFill(rem){
  const cellH=document.querySelector('.grid-cell')?.offsetHeight||62;

  // 1. ë§ì¶˜ íƒ€ì¼ ì¦‰ì‹œ ì¶•ì†Œ
  rem.forEach(({r,c})=>{
    const tile=getCell(r,c)?.querySelector('.tile');
    if(tile){tile.style.transition='transform .1s ease,opacity .1s ease';tile.style.transform='scale(0)';tile.style.opacity='0';}
  });

  setTimeout(()=>{
    // 2. ë³´ë“œ ë°ì´í„° ì—…ë°ì´íŠ¸
    rem.forEach(({r,c})=>{board[r][c]=null;getCell(r,c).innerHTML='';});

    // 3. ì»¬ëŸ¼ë³„ ìŠ¬ë¼ì´ë“œ ë‹¤ìš´
    for(let c=0;c<COLS;c++){
      let gaps=0;
      for(let r=ROWS-1;r>=0;r--){
        if(!board[r][c]){gaps++;}
        else if(gaps>0){
          // íƒ€ì¼ DOMì„ ì•„ë˜ ì…€ë¡œ ì´ë™
          const fromCell=getCell(r,c);
          const toCell=getCell(r+gaps,c);
          const tile=fromCell.querySelector('.tile');
          if(tile&&toCell){
            const dist=gaps*(cellH+4);
            const movedTile=tile.cloneNode(true);
            movedTile.style.transition='none';
            movedTile.style.transform=`translateY(-${dist}px)`;
            fromCell.removeChild(tile);
            toCell.appendChild(movedTile);
            requestAnimationFrame(()=>{
              movedTile.style.transition='transform .15s cubic-bezier(.2,1.2,.5,1)';
              movedTile.style.transform='translateY(0)';
            });
            board[r+gaps][c]=board[r][c];
            board[r][c]=null;
          }
        }
      }

      // 4. ë¹ˆ ë§¨ ìœ„ ì¹¸ì— ìƒˆ íƒ€ì¼ ìœ„ì—ì„œ ë‚™í•˜
      for(let r=0;r<ROWS;r++){
        if(!board[r][c]){
          board[r][c]=mkTile();
          const cell=getCell(r,c);
          const el=document.createElement('div');
          el.className=`tile t${board[r][c].v}`;
          el.dataset.id=board[r][c].id;
          el.innerHTML=makeTileInner(board[r][c]);
          el.style.transform='translateY(-80px)';
          el.style.opacity='0';
          el.style.transition='none';
          cell.appendChild(el);
          requestAnimationFrame(()=>{
            el.style.transition=`transform .18s cubic-bezier(.2,1.3,.5,1),opacity .12s ease`;
            el.style.transform='translateY(0)';
            el.style.opacity='1';
          });
        }
      }
    }

    updateScore();updateCombo();updateSumBar(0);updatePVP();
  },110);
}

// render â€” pushRowì—ì„œ ì‚¬ìš© (buildGrid ë˜í•‘)
function render(){buildGrid();}

function onTap(r,c){
  if(!running)return;
  const idx=sel.findIndex(s=>s.r===r&&s.c===c);
  if(idx>=0)sel.splice(idx,1);else sel.push({r,c});
  const sum=getSum();
  sndSelect(board[r][c]?board[r][c].v:5);
  if(sum>TARGET){
    if(phase()==='hard'){timeLeft=Math.max(0,timeLeft-2);updateTimer();showFx('â°-2ì´ˆ',mx(r,c),my(r,c),'#ff4f4f',22);}
    vibrate([80,30,80]);
    sndFail();sel=[];
    const bar=document.getElementById('sumBar');bar.classList.add('shake');setTimeout(()=>bar.classList.remove('shake'),300);
    showFx('ì•¼ì˜¹?!',window.innerWidth/2,window.innerHeight*.4,'#ff4f4f',32);
    flash('ng');
    document.body.classList.add('shakebody');setTimeout(()=>document.body.classList.remove('shakebody'),450);
    updateSumBar(0);renderSelection();return;
  }
  updateSumBar(sum);renderSelection();
  if(sum===TARGET&&sel.length>=2)doRemove();
}
function getSum(){return sel.reduce((s,{r,c})=>s+(board[r][c]?board[r][c].v:0),0);}

function showComboBurst(combo, cnt){
  const el=document.createElement('div');
  el.className='combo-burst';
  let txt, color, size;
  if(cnt>=4)      {txt=`ğŸ’¥\n4ê°œ!`;color='#ff6eb4';size=52;}
  else if(cnt===3){txt=`âš¡\n3ê°œ!`;color='#4ecdc4';size=46;}
  else if(combo>=5){txt=`ğŸŒŸ\nCOMBO\nÃ—${combo}`;color='#c5b8ff';size=44;}
  else if(combo>=3){txt=`ğŸ”¥\nCOMBO\nÃ—${combo}`;color='#ff9fd3';size=40;}
  else return; // 2ê°œ ì¼ë°˜ì€ ì¤‘ì•™ í„°ëœ¨ë¦¬ê¸° ì—†ìŒ
  el.style.cssText=`font-size:${size}px;color:${color};text-shadow:0 4px 16px rgba(0,0,0,.2);line-height:1.1;white-space:pre;`;
  el.textContent=txt;
  document.body.appendChild(el);
  setTimeout(()=>el.remove(),560);
}

function doRemove(){
  const rem=[...sel];const cnt=rem.length;
  combo++;clearTimeout(cTimer);cTimer=setTimeout(()=>{combo=0;updateCombo();},4500);
  if(combo===3)dc3hits++; // 3ì½¤ë³´ ë‹¬ì„± íšŸìˆ˜ ì¶”ì 

  // ğŸ¯ íƒ€ì¼ ìˆ˜ ë³´ë„ˆìŠ¤ (2ê°œ=Ã—1, 3ê°œ=Ã—1.5, 4ê°œ=Ã—2.5)
  const cntMult=cnt>=4?2.5:cnt===3?1.5:1;
  const comboMult=combo>=3?1.5:1;
  const totalMult=cntMult*comboMult;
  const base=cnt*10;
  const earned=Math.round(base*totalMult);
  score+=earned;cleared+=cnt;

  // FX í…ìŠ¤íŠ¸ë§Œ â€” spawnPt ì œê±° (getBoundingClientRect ë¦¬í”Œë¡œìš° ì—†ì•°)
  let fxTxt, fxColor, fxSize;
  if(cnt>=4)       {fxTxt='ğŸ’¥ 4ê°œ!+'+earned;fxColor='#ff6eb4';fxSize=30;}
  else if(cnt===3) {fxTxt='âš¡ 3ê°œ!+'+earned;fxColor='#4ecdc4';fxSize=28;}
  else if(combo>=5){fxTxt='ğŸŒŸ COMBO!!';fxColor='#c5b8ff';fxSize=32;}
  else if(combo>=3){fxTxt='ğŸ”¥ COMBO!';fxColor='#c5b8ff';fxSize=28;}
  else             {fxTxt='ëƒ¥~âœ¨';fxColor='var(--pink)';fxSize=26;}

  showFx(fxTxt,mx(rem[0].r,rem[0].c),my(rem[0].r,rem[0].c),fxColor,fxSize);
  showComboBurst(combo, cnt);

  // ë³´ë„ˆìŠ¤ ì ìˆ˜ ë³„ë„ í‘œì‹œ
  if(cnt>=3) showFx(`+${earned}ì `,mx(rem[0].r,rem[0].c),my(rem[0].r,rem[0].c)+36,'#ffcc00',20);

  flash('ok');
  const gw=document.getElementById('gridWrap');gw.classList.add('success-zoom');setTimeout(()=>gw.classList.remove('success-zoom'),350);
  if(cnt>=3||combo>=3){
    const cf=document.createElement('div');
    cf.className=(cnt>=5||combo>=5)?'combo5-flash':'combo-flash';
    if(cf.className==='combo-flash')cf.style.background=cnt>=3?'rgba(78,205,196,.25)':'rgba(255,110,180,.2)';
    document.body.appendChild(cf);setTimeout(()=>cf.remove(),600);
  }
  sndSuccess(Math.max(combo,cnt>=3?3:0));
  vibrate(cnt>=3?[30,15,30,15,60]:combo>=3?[40,20,40,20,60]:40);
  sel=[];checkMS();
  animateRemoveAndFill(rem);
}

function startPressure(){clearTimeout(pTimer);const p=phase();if(p==='easy')return;pTimer=setTimeout(()=>{if(running)pushRow();startPressure();},{mid:4000,hard:2500}[p]||4000);}
function pushRow(){for(let r=ROWS-1;r>0;r--)board[r]=[...board[r-1]];board[0]=[];for(let c=0;c<COLS;c++)board[0][c]=mkTile();render();}

function startOpp(){
  clearInterval(oppTimer);oppScore=0;
  const target=window._todayBest||randBotTarget();
  const botName=randBotName();
  const oppNameEl=document.getElementById('pvpOppName');
  if(oppNameEl) oppNameEl.textContent=botName;
  oppTimer=setInterval(()=>{if(!running){clearInterval(oppTimer);return;}const elapsed=DURATION-timeLeft;oppScore=Math.floor((target/DURATION)*elapsed*(0.85+Math.random()*.3));updatePVP();},1000);
}
function updatePVP(){
  const max=300;
  document.getElementById('pvpMyBar').style.width=Math.min(100,score/max*100)+'%';
  document.getElementById('pvpOppBar').style.width=Math.min(100,oppScore/max*100)+'%';
  document.getElementById('pvpMyPts').textContent=score;
  document.getElementById('pvpOppPts').textContent=oppScore;
  const ahead=score>oppScore;
  document.getElementById('pvpStatus').textContent=ahead?'ğŸ”¥':'ğŸ’¨';
  document.getElementById('pvpStatus').style.color=ahead?'var(--mint)':'#ff9040';
}

function checkMS(){SMS.forEach(m=>{if(score>=m.v&&!dSMS.has(m.v)){dSMS.add(m.v);showMS(m.m);}});CMS.forEach(m=>{if(combo>=m.v&&!dCMS.has(m.v)){dCMS.add(m.v);showMS(m.m);}});}
function showMS(msg){const el=document.createElement('div');el.className='milestone';el.textContent=msg;document.body.appendChild(el);setTimeout(()=>el.remove(),2000);}
function updateScore(){const el=document.getElementById('scoreVal');el.textContent=score;el.classList.remove('pop');void el.offsetWidth;el.classList.add('pop');}
function updateCombo(){const el=document.getElementById('comboPill');if(combo>=3){el.textContent=`Ã—1.5 ğŸ”¥`;el.className='combo-pill on';}else if(combo>=2){el.textContent=`ğŸ”¥ ì½¤ë³´!`;el.className='combo-pill on';}else{el.textContent='Ã—1';el.className='combo-pill';}}
function updateSumBar(sum){
  const bar=document.getElementById('sumBar'),num=document.getElementById('sumNum'),tip=document.getElementById('sumTip');
  bar.className='sum-bar';
  const cnt=sel.length;
  if(!sum||!cnt){num.textContent='â€”';num.className='sum-num';tip.textContent='ê³ ì–‘ì´ë¥¼ ê³¨ë¼ë´ ğŸ±';tip.className='sum-tip';}
  else if(sum===TARGET){
    num.textContent=sum;num.className='sum-num exact';
    const bonus=cnt>=4?'Ã—2.5 ğŸ’¥':cnt===3?'Ã—1.5 âš¡':'';
    tip.textContent='ì™„ì„±! '+bonus;tip.className='sum-tip exact';bar.classList.add('exact');
  }
  else if(TARGET-sum<=2){num.textContent=sum;num.className='sum-num close';tip.textContent=`${TARGET-sum} ë”ë©´ ë¼!`;tip.className='sum-tip';bar.classList.add('close-glow');}
  else{
    num.textContent=sum;num.className='sum-num';
    tip.textContent=cnt>=3?`${TARGET-sum} ë”! âš¡ë³´ë„ˆìŠ¤`:`${TARGET-sum} ë”!`;tip.className='sum-tip';
  }
}
function updateTimer(){
  const ring=document.getElementById('timerRing'),num=document.getElementById('timerNum'),border=document.getElementById('panicBorder');
  ring.style.strokeDashoffset=CIRC*(1-timeLeft/DURATION);
  if(timeLeft<=10){
    ring.style.stroke='#ff4f4f';num.style.color='#ff4f4f';border.className='panic-border on';
    if(timeLeft===10)startTickSound(); // ğŸµ ë§‰íŒ í‹± ì‹œì‘
  }else if(timeLeft<=20){ring.style.stroke='#ff9040';num.style.color='#ff9040';border.className='panic-border';}
  else{ring.style.stroke='var(--pink)';num.style.color='var(--text)';border.className='panic-border';}
  num.textContent=timeLeft;
}
function flash(type){const el=document.getElementById('flashOv');el.className='flash-ov '+type;setTimeout(()=>el.className='flash-ov',500);}
function showFx(txt,x,y,color,size){const d=document.createElement('div');d.className='fx';d.textContent=txt;d.style.cssText=`left:${x}px;top:${y}px;color:${color};font-size:${size}px;`;document.body.appendChild(d);setTimeout(()=>d.remove(),1000);}
function spawnPt({r,c},count=20){
  const el=getTEl(r,c);if(!el)return;const rect=el.getBoundingClientRect();
  const colors=['#ff6eb4','#ffb3d4','#ffd6a5','#b5ead7','#c5b8ff','#fdffb6','#ff9090','#a8e6f0'];
  for(let i=0;i<count;i++){const p=document.createElement('div');p.className='pt';const a=(i/count)*Math.PI*2+(Math.random()*.3),d=35+Math.random()*50,s=6+Math.random()*9;p.style.cssText=`width:${s}px;height:${s}px;background:${colors[i%colors.length]};left:${rect.left+rect.width/2}px;top:${rect.top+rect.height/2}px;--tx:${Math.cos(a)*d}px;--ty:${Math.sin(a)*d}px;transform:translate(-50%,-50%);`;document.body.appendChild(p);setTimeout(()=>p.remove(),700);}
}
function getTEl(r,c){return document.getElementById('gridWrap').querySelector(`.grid-cell[data-pos="${r}-${c}"]`);}
function mx(r,c){const el=getTEl(r,c);if(!el)return window.innerWidth/2;const rect=el.getBoundingClientRect();return rect.left+rect.width/2;}
function my(r,c){const el=getTEl(r,c);if(!el)return window.innerHeight*.4;const rect=el.getBoundingClientRect();return rect.top;}

function openPrivacy(){document.getElementById('privacyModal').classList.remove('hidden');}
function closePrivacy(){document.getElementById('privacyModal').classList.add('hidden');}
function closePrivacyBg(e){if(e.target===document.getElementById('privacyModal'))closePrivacy();}

function confirmRestart(){
  if(!running)return;
  document.getElementById('restartModal').classList.remove('hidden');
}
function doRestart(){
  document.getElementById('restartModal').classList.add('hidden');
  clearInterval(ticker);clearTimeout(cTimer);clearTimeout(pTimer);clearInterval(oppTimer);
  stopBGM();stopTickSound();running=false;
  const ov=document.getElementById('cdOv'),ne=document.getElementById('cdN');
  ov.classList.remove('hidden');let n=3;ne.textContent=n;
  const iv=setInterval(()=>{
    n--;
    playTone(n>0?440:880,'sine',0.15,0.3);
    if(n>0){ne.textContent=n;ne.style.animation='none';void ne.offsetWidth;ne.style.animation='';}
    else{clearInterval(iv);ov.classList.add('hidden');startGame();}
  },850);
}
function cancelRestart(){
  document.getElementById('restartModal').classList.add('hidden');
}

function showBestBurst(){
  const el=document.getElementById('bestBurst');
  el.classList.remove('hidden');
  setTimeout(()=>el.classList.add('hidden'),2100);
}

function closeTut(){
  document.getElementById('tutOv').classList.add('hidden');
  localStorage.setItem('n10_tutdone','1');
  firstStart();
}

function firstStart(){
  // ì²« í”Œë ˆì´ì–´ë©´ íŠœí† ë¦¬ì–¼ ë¨¼ì €
  if(!localStorage.getItem('n10_tutdone')){
    document.getElementById('tutOv').classList.remove('hidden');
    return;
  }
  showScreen(null);
  sndStart();
  const ov=document.getElementById('cdOv'),ne=document.getElementById('cdN');
  ov.classList.remove('hidden');let n=3;ne.textContent=n;
  const iv=setInterval(()=>{
    n--;
    playTone(n>0?440:880,'sine',0.15,0.3); // ì¹´ìš´íŠ¸ë‹¤ìš´ ë¹„í”„
    if(n>0){ne.textContent=n;ne.style.animation='none';void ne.offsetWidth;ne.style.animation='';}
    else{clearInterval(iv);ov.classList.add('hidden');startGame();}
  },850);
}

function instantRetry(){
  sndStart();
  const ov=document.getElementById('cdOv'),ne=document.getElementById('cdN');
  ov.classList.remove('hidden');let n=3;ne.textContent=n;
  const iv=setInterval(()=>{
    n--;
    playTone(n>0?440:880,'sine',0.15,0.3);
    if(n>0){ne.textContent=n;ne.style.animation='none';void ne.offsetWidth;ne.style.animation='';}
    else{clearInterval(iv);ov.classList.add('hidden');startGame();}
  },850);
}

function startGame(){
  if(typeof stopLbListen==='function')stopLbListen();
  stopBGM();
  clearInterval(ticker);clearTimeout(cTimer);clearTimeout(pTimer);clearInterval(oppTimer);stopTickSound();
  board=[];sel=[];score=0;cleared=0;combo=0;timeLeft=DURATION;running=true;tid=0;oppScore=0;
  dSMS=new Set();dCMS=new Set();dc3hits=0;
  document.getElementById('panicBorder').className='panic-border';
  initBoard();updateScore();updateCombo();updateSumBar(0);updateTimer();updatePVP();
  showScreen('game');
  buildGrid();
  startOpp();
  startBGM();
  ticker=setInterval(()=>{
    timeLeft--;updateTimer();
    if(timeLeft===40||timeLeft===15)startPressure();
    // 10ì´ˆë§ˆë‹¤ oppScore ì••ë°• ì¦ê°€ë¡œ ê¸´ì¥ê° ìœ ë„
    if(timeLeft>0&&timeLeft%10===0&&timeLeft<50){
      const rush=document.createElement('div');
      rush.className='milestone';
      rush.textContent=timeLeft<=15?'âš¡ ë§‰íŒì´ë‹¤!':timeLeft<=30?'ğŸ”¥ ì†ë„ë¥¼ ì˜¬ë ¤!':'ğŸ’¨ ì§‘ì¤‘!';
      document.body.appendChild(rush);setTimeout(()=>rush.remove(),1800);
    }
    if(timeLeft<=0){clearInterval(ticker);clearTimeout(pTimer);clearInterval(oppTimer);running=false;stopBGM();sndGameOver();checkDailyChallenge();setTimeout(showResult,150);}
  },1000);
}

function handleResultTap(e){
  // Only retry if tap on background, not on buttons/interactive elements
  if(e.target.tagName==='BUTTON'||e.target.tagName==='svg'||e.target.tagName==='path'||e.target.tagName==='circle'||e.target.closest('.lb-card')||e.target.closest('.share-section')||e.target.closest('button'))return;
  instantRetry();
}

function showResult(){
  document.getElementById('panicBorder').className='panic-border';
  const isNewBest=score>best;
  if(isNewBest){best=score;localStorage.setItem('n10best',best);}
  if(typeof fbSubmit==='function'){
    fbSubmit(score).then(()=>{
      if(typeof fbLeaderboard==='function')fbLeaderboard(score);
    }).catch(()=>{
      if(typeof fbLeaderboard==='function')fbLeaderboard(score);
    });
  } else {
    if(typeof fbLeaderboard==='function')fbLeaderboard(score);
  }
  const g=[...GRADES].reverse().find(g=>score>=g.min)||GRADES[0];
  document.getElementById('resEmoji').textContent=g.e;
  const ge=document.getElementById('resGrade');ge.textContent=g.t;ge.style.cssText=`background:${g.bg};color:${g.c}`;
  document.getElementById('resTiles').textContent=cleared;
  document.getElementById('resBest').innerHTML=`BEST: <b>${best}</b>`;
  // ìµœê³ ì ê¹Œì§€ ì°¨ì´ í‘œì‹œ
  const gapEl=document.getElementById('resBestGap');
  if(gapEl){
    const gap=best-score;
    if(gap>0)gapEl.textContent=`ìµœê³ ì ê¹Œì§€ ë”± ${gap}ì ! í•œ ë²ˆë§Œ ë”! ğŸ”¥`;
    else gapEl.textContent=`ğŸ† ìµœê³ ì  ê²½ì‹ !`;
  }
  showScreen('result');
  // ì ìˆ˜ ì¹´ìš´íŠ¸ì—…
  const scoreEl=document.getElementById('resScore');
  scoreEl.textContent='0';
  const duration=800;const steps=40;const increment=score/steps;let current=0;
  const iv=setInterval(()=>{
    current=Math.min(current+increment,score);
    scoreEl.textContent=Math.floor(current);
    if(current>=score){clearInterval(iv);scoreEl.textContent=score;if(isNewBest)showBestBurst();}
  },duration/steps);
}

function showScreen(name){['start','game','result'].forEach(n=>document.getElementById(n+'Screen').classList.add('hidden'));if(name)document.getElementById(name+'Screen').classList.remove('hidden');}

function shareScore(){
  const g=[...GRADES].reverse().find(g=>score>=g.min)||GRADES[0];
  const rankTxt=document.getElementById('resRank').textContent||'';
  // Build canvas share card
  const canvas=document.createElement('canvas');
  canvas.width=600;canvas.height=360;
  const ctx=canvas.getContext('2d');
  // Background gradient
  const grad=ctx.createLinearGradient(0,0,600,360);
  grad.addColorStop(0,'#fef6ff');grad.addColorStop(1,'#ffe0f5');
  ctx.fillStyle=grad;
  ctx.beginPath();ctx.roundRect(0,0,600,360,28);ctx.fill();
  // Pink border
  ctx.strokeStyle='#ff9fd3';ctx.lineWidth=4;
  ctx.beginPath();ctx.roundRect(2,2,596,356,26);ctx.stroke();
  // Logo
  ctx.fillStyle='#ff6eb4';ctx.font='bold 36px sans-serif';ctx.textAlign='center';
  ctx.fillText('ëƒ¥10 ğŸ±',300,52);
  // Grade pill background
  ctx.fillStyle=g.bg;
  ctx.beginPath();ctx.roundRect(220,70,160,38,20);ctx.fill();
  ctx.fillStyle=g.c;ctx.font='bold 20px sans-serif';ctx.textAlign='center';
  ctx.fillText(g.t,300,95);
  // Big emoji
  ctx.font='90px sans-serif';ctx.fillText(g.e,300,185);
  // Score
  ctx.fillStyle='#ff6eb4';ctx.font='bold 86px sans-serif';
  ctx.shadowColor='#d94d96';ctx.shadowOffsetY=5;ctx.shadowBlur=0;
  ctx.fillText(score+'ì ',300,288);ctx.shadowColor='transparent';
  // Rank text
  if(rankTxt){ctx.fillStyle='#4ecdc4';ctx.font='bold 18px sans-serif';ctx.fillText(rankTxt,300,320);}
  // Bottom tagline
  ctx.fillStyle='#b89db8';ctx.font='bold 14px sans-serif';
  ctx.fillText('ë‚˜ë³´ë‹¤ ì˜í•˜ë©´ ì¸ì • ğŸ¾  Can you beat my '+score+'?',300,348);
  canvas.toBlob(blob=>{
    const file=new File([blob],'nyang10.png',{type:'image/png'});
    if(navigator.canShare&&navigator.canShare({files:[file]})){
      navigator.share({files:[file],title:'ëƒ¥10',text:`${g.e} ${g.t} ë‹¬ì„± â€” ${score}ì !\n${rankTxt}`}).catch(()=>{});
    } else {
      const url=URL.createObjectURL(blob);const a=document.createElement('a');
      a.href=url;a.download='nyang10_score.png';a.click();URL.revokeObjectURL(url);
    }
  },'image/png');
}

function getShareText(){
  const g=[...GRADES].reverse().find(g=>score>=g.min)||GRADES[0];
  const rankTxt=document.getElementById('resRank').textContent||'';
  return `${g.e} ëƒ¥10ì—ì„œ ${score}ì  ë‹¬ì„±! ${rankTxt?rankTxt+' ':''}ë‚˜ë³´ë‹¤ ì˜í•˜ë©´ ì¸ì • ğŸ¾ #ëƒ¥10 #ìˆ«ìí¼ì¦`;
}
function getGameUrl(){return location.href.split('?')[0];}

function shareToX(){
  const txt=encodeURIComponent(getShareText()+'\n'+getGameUrl());
  window.open(`https://x.com/intent/post?text=${txt}`,'_blank');
}
function shareToThreads(){
  const txt=encodeURIComponent(getShareText()+'\n'+getGameUrl());
  window.open(`https://www.threads.com/intent/post?text=${txt}`,'_blank');
}
function shareToKakao(){
  const txt=getShareText()+'\n'+getGameUrl();
  navigator.clipboard.writeText(txt).then(()=>showToast('ì¹´í†¡ì— ë¶™ì—¬ë„£ê¸° í•´ì£¼ì„¸ìš”! ğŸ“‹')).catch(()=>showToast('ë§í¬ë¥¼ ë³µì‚¬í•´ì„œ ì¹´í†¡ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”!'));
}
function copyLink(){
  const txt=getShareText()+'\n'+getGameUrl();
  navigator.clipboard.writeText(txt).then(()=>showToast('í´ë¦½ë³´ë“œì— ë³µì‚¬ëì–´ìš”! ğŸ“‹')).catch(()=>showToast('ë³µì‚¬ ì‹¤íŒ¨ ğŸ˜¢'));
}
function showToast(msg){
  const t=document.createElement('div');
  t.style.cssText='position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:#3d2645;color:white;padding:10px 20px;border-radius:20px;font-family:Nunito,sans-serif;font-weight:800;font-size:13px;z-index:999;white-space:nowrap;box-shadow:0 4px 20px rgba(0,0,0,.2);';
  t.textContent=msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),2500);
}

showScreen('start');
loadSettingsData();
// ì €ì¥ëœ ìŠ¤í‚¨ ì ìš©
(()=>{const skin=CAT_SKINS&&CAT_SKINS.find(s=>s.id===settings.skin);if(skin)window._curSkin=skin;})();

// â”€â”€ ì¼ì¼ ì±Œë¦°ì§€ â”€â”€
const DAILY_CHALLENGES=[
  {id:'combo5',  text:'ì½¤ë³´ 5 ë‹¬ì„±í•˜ê¸° ğŸ”¥',   check:()=>Array.from(dCMS).includes(5)||combo>=5},
  {id:'score100',text:'100ì  ë‹¬ì„±í•˜ê¸° ğŸ’¯',     check:()=>score>=100},
  {id:'tile20',  text:'íƒ€ì¼ 20ê°œ ì œê±°í•˜ê¸° ğŸ±', check:()=>cleared>=20},
  {id:'score200',text:'200ì  ë‹¬ì„±í•˜ê¸° ğŸ‘‘',     check:()=>score>=200},
  {id:'combo3x2',text:'3ì½¤ë³´ ë‘ ë²ˆ ë‹¬ì„±í•˜ê¸° âš¡',check:()=>dc3hits>=2},
];
function todayChallenge(){
  const d=new Date();
  const idx=(d.getFullYear()*366+d.getMonth()*31+d.getDate())%DAILY_CHALLENGES.length;
  return DAILY_CHALLENGES[idx];
}
function initDailyChallenge(){
  const ch=todayChallenge();
  const key='n10_dc_'+new Date().toDateString();
  const done=localStorage.getItem(key)==='1';
  document.getElementById('dcText').textContent=ch.text;
  document.getElementById('dcStatus').textContent=done?'âœ…':'â¬œ';
}
function checkDailyChallenge(){
  const ch=todayChallenge();
  const key='n10_dc_'+new Date().toDateString();
  if(localStorage.getItem(key)==='1')return;
  if(ch.check()){
    localStorage.setItem(key,'1');
    document.getElementById('dcStatus').textContent='âœ…';
    showMS('ğŸ¯ ì˜¤ëŠ˜ì˜ ë¯¸ì…˜ ì™„ë£Œ!');
  }
}
initDailyChallenge();

// â”€â”€ ìŠ¤í‚¨ ì ê¸ˆ/í•´ê¸ˆ â”€â”€
const SKIN_UNLOCK={
  classic:{unlocked:true},
  fancy:  {unlocked:()=>best>=50,  hint:'BEST 50ì  ë‹¬ì„±'},
  star:   {unlocked:()=>best>=100, hint:'BEST 100ì  ë‹¬ì„±'},
  food:   {unlocked:()=>best>=150, hint:'BEST 150ì  ë‹¬ì„±'},
  pure:   {unlocked:()=>best>=200, hint:'BEST 200ì  ë‹¬ì„±'},
};
function isSkinUnlocked(id){
  const u=SKIN_UNLOCK[id];if(!u)return true;
  return u.unlocked===true||(typeof u.unlocked==='function'&&u.unlocked());
}
</script>
</body>
</html>
